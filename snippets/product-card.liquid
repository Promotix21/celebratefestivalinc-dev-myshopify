{%- comment -%}
  Renders a product card for grid view (PLP style)

  Accepts:
  - product: {Object} Product object
  - show_vendor: {Boolean} Show brand/vendor
  - show_rating: {Boolean} Show product rating
  - image_ratio: {String} Image aspect ratio
  - show_quick_add: {Boolean} Show quick add button
  - show_sale_badge: {Boolean} Show sale badge
  - show_sku: {Boolean} Show product SKU
  - show_qty_input: {Boolean} Show quantity input with add to cart

  Usage:
  {% render 'product-card', product: product, show_vendor: true %}
{%- endcomment -%}

{%- liquid
  assign show_vendor = show_vendor | default: true
  assign show_rating = show_rating | default: true
  assign image_ratio = image_ratio | default: 'adapt'
  assign show_quick_add = show_quick_add | default: false
  assign show_sale_badge = show_sale_badge | default: true
  assign show_sku = show_sku | default: true
  assign show_qty_input = show_qty_input | default: true

  assign on_sale = false
  if product.compare_at_price > product.price
    assign on_sale = true
  endif

  assign low_stock = false
  assign total_inventory = 0
  for variant in product.variants
    assign total_inventory = total_inventory | plus: variant.inventory_quantity
  endfor
  if total_inventory > 0 and total_inventory <= 10
    assign low_stock = true
  endif

  assign call_for_price = false
  if product.metafields.custom.call_for_price == true or product.tags contains 'call-for-price'
    assign call_for_price = true
  endif

  assign product_sku = product.selected_or_first_available_variant.sku

  comment
    Check if customer is a member (logged in with wholesale tags)
  endcomment
  assign is_member = false
  if customer
    for tag in customer.tags
      assign tag_lower = tag | downcase
      if tag_lower contains 'wholesale' or tag_lower contains 'plus' or tag_lower contains 'member' or tag_lower contains 'cph' or tag_lower contains 'rou' or tag_lower contains 'margin'
        assign is_member = true
        break
      endif
    endfor
  endif

  comment
    Check if product is own-brand (Celebrate Festival Inc)
  endcomment
  assign is_own_brand = false
  assign vendor_lower = product.vendor | downcase
  if vendor_lower contains 'celebrate festival' or vendor_lower contains 'celebratefest'
    assign is_own_brand = true
  endif

  comment
    Get voltage/power info from tags
  endcomment
  assign voltage_badge = blank
  for tag in product.tags
    assign tag_lower = tag | downcase
    if tag_lower contains 'volt' or tag_lower contains '115v' or tag_lower contains '208v' or tag_lower contains '220v' or tag_lower contains '240v'
      assign voltage_badge = tag
      break
    endif
  endfor

  comment
    Bug Fix #5: Check if product is USA made (should not show "Login for Member Pricing")
    USA products are identified by tags or vendor or country metafield
  endcomment
  assign is_usa_product = false
  for tag in product.tags
    assign tag_lower = tag | downcase
    if tag_lower contains 'usa' or tag_lower contains 'made in usa' or tag_lower contains 'made-in-usa' or tag_lower contains 'american' or tag_lower contains 'domestic' or tag_lower contains 'made in america'
      assign is_usa_product = true
      break
    endif
  endfor
  if product.metafields.custom.country_of_origin != blank
    assign country_lower = product.metafields.custom.country_of_origin | downcase
    if country_lower contains 'usa' or country_lower contains 'united states' or country_lower contains 'america'
      assign is_usa_product = true
    endif
  endif

  comment
    Bug Fix #4: Check if product is Indian (should not show member pricing to logged out users)
    Indian products are identified by tags, vendor name, or product type
  endcomment
  assign is_indian_product = false
  for tag in product.tags
    assign tag_lower = tag | downcase
    if tag_lower contains 'indian' or tag_lower contains 'india' or tag_lower contains 'made in india'
      assign is_indian_product = true
      break
    endif
  endfor
  if product.metafields.custom.country_of_origin != blank
    assign country_lower = product.metafields.custom.country_of_origin | downcase
    if country_lower contains 'india'
      assign is_indian_product = true
    endif
  endif
  assign product_type_lower = product.type | downcase
  if product_type_lower contains 'indian'
    assign is_indian_product = true
  endif
-%}

{%- comment -%} Calculate WSH wholesale pricing {%- endcomment -%}
{%- render 'wcp_discount', wcp_discount: product -%}

{%- liquid
  comment
    Determine if we have a wholesale price different from regular
  endcomment
  assign has_wholesale_price = false
  assign wholesale_price = wcp_price
  assign regular_price = product.price

  if wcp_price != blank and wcp_price < product.price
    assign has_wholesale_price = true
    assign wholesale_price = wcp_price
  endif

  comment
    Fallback: if no WSH price, check compare_at_price
  endcomment
  if has_wholesale_price == false and on_sale
    assign has_wholesale_price = true
    assign wholesale_price = product.price
    assign regular_price = product.compare_at_price
  endif

  comment
    Calculate savings for display
  endcomment
  assign savings_amount = 0
  assign savings_percent = 0
  if has_wholesale_price and regular_price > wholesale_price
    assign savings_amount = regular_price | minus: wholesale_price
    assign savings_percent = savings_amount | times: 100.0 | divided_by: regular_price | round
  endif

  comment
    Determine pricing display mode:
    - price-single: Non-member viewing restricted product (retail only)
    - price-dual: Non-member viewing own-brand product (both prices) - Bug Fix #4: except Indian products
    - price-member-view: Member viewing any product (member pricing)
  endcomment
  assign pricing_mode = 'price-single'
  if is_member and has_wholesale_price
    assign pricing_mode = 'price-member-view'
  elsif is_member
    assign pricing_mode = 'price-member-view'
  elsif is_own_brand and has_wholesale_price and is_indian_product == false
    assign pricing_mode = 'price-dual'
  else
    assign pricing_mode = 'price-single'
  endif
-%}

<div class="product-card" data-product-id="{{ product.id }}">
  <a href="{{ product.url }}" class="product-link">

    <!-- Product Image -->
    <div class="card-image">
      {%- if product.featured_media -%}
        <img
          src="{{ product.featured_media | image_url: width: 400 }}"
          srcset="{{ product.featured_media | image_url: width: 200 }} 200w,
                  {{ product.featured_media | image_url: width: 400 }} 400w"
          alt="{{ product.featured_media.alt | escape }}"
          loading="lazy"
          width="160"
          height="160"
        >

        {%- if product.media[1] != nil -%}
          <img
            src="{{ product.media[1] | image_url: width: 400 }}"
            alt="{{ product.media[1].alt | escape }}"
            loading="lazy"
            class="product-image-hover"
          >
        {%- endif -%}
      {%- else -%}
        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
      {%- endif -%}

      <!-- Product Badges -->
      <div class="badge-container">
        {%- if voltage_badge != blank -%}
          <span class="voltage-badge">{{ voltage_badge }}</span>
        {%- endif -%}

        {%- if low_stock -%}
          <span class="badge low-stock-badge">Low Stock</span>
        {%- endif -%}

        {%- if product.tags contains 'new' -%}
          <span class="badge new-badge">New</span>
        {%- endif -%}

        {%- if is_own_brand and has_wholesale_price and is_member == false -%}
          <span class="member-badge">Member Pricing</span>
        {%- endif -%}

        {%- comment -%} IMP-004 FIX: Add variations badge {%- endcomment -%}
        {%- if product.variants.size > 1 -%}
          <span class="badge variations-badge">{{ product.variants.size }} Options</span>
        {%- endif -%}
      </div>

      <!-- Wishlist Button -->
      <button
        type="button"
        class="wishlist-btn"
        data-wishlist-btn
        data-product-id="{{ product.id }}"
        data-product-title="{{ product.title | escape }}"
        data-product-handle="{{ product.handle }}"
        data-product-image="{{ product.featured_media | image_url: width: 400 }}"
        data-product-price="{{ product.price }}"
        data-product-compare-price="{{ product.compare_at_price }}"
        data-product-url="{{ product.url }}"
        aria-label="Add to wishlist"
      >
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      </button>
    </div>
  </a>

  <!-- Product Info -->
  <div class="card-content">
    <a href="{{ product.url }}" class="product-title-link">
      <h3 class="card-title">{{ product.title }}</h3>
    </a>

    {%- if show_rating -%}
      <div class="card-meta">
        <div class="rating">
          <span class="stars">&#9733;&#9733;&#9733;&#9733;<span class="empty">&#9733;</span></span>
        </div>
        {%- if show_sku and product_sku != blank -%}
          <span class="sku">#{{ product_sku }}</span>
        {%- endif -%}
      </div>
    {%- elsif show_sku and product_sku != blank -%}
      <div class="card-meta">
        <span class="sku">#{{ product_sku }}</span>
      </div>
    {%- endif -%}

    <!-- Pricing Container -->
    {%- if call_for_price -%}
      <div class="price-single">
        <div class="price-label-single">Contact Us</div>
        <a href="{{ product.url }}" class="price-amount-single" style="font-size: 18px; color: #2d5a87; text-decoration: none;">Call for Best Price</a>
      </div>
    {%- else -%}

      {%- case pricing_mode -%}

        {%- when 'price-member-view' -%}
          <!-- MEMBER VIEW - Always shows member pricing with coral border -->
          <div class="price-member-view">
            <div class="member-view-price">
              {%- if has_wholesale_price -%}
                {{ wholesale_price | money }}
              {%- else -%}
                {{ product.price | money }}
              {%- endif -%}
            </div>
            {%- if has_wholesale_price -%}
              <div class="member-view-regular">Retail: <s>{{ regular_price | money }}</s></div>
              <div class="member-view-savings">You Save {{ savings_amount | money }}</div>
            {%- endif -%}
          </div>

        {%- when 'price-dual' -%}
          <!-- PUBLIC VIEW - Own Brand Products: Show both prices -->
          <div class="price-dual">
            <div class="member-price-label">Member Price</div>
            <div class="member-price-amount">{{ wholesale_price | money }}</div>
            <div class="regular-price-strike">Retail: <s>{{ regular_price | money }}</s></div>
            <div class="savings-tag">Save {{ savings_amount | money }} ({{ savings_percent }}%)</div>
          </div>

        {%- else -%}
          <!-- PUBLIC VIEW - Restricted Products: Single retail price only -->
          <div class="price-single">
            <div class="price-label-single">Retail Price</div>
            <div class="price-amount-single">{{ product.price | money }}<span class="price-unit">/Each</span></div>
          </div>
          <!-- Login for Member Pricing Label - Bug Fix #5: Hide for USA products -->
          {%- unless customer or is_usa_product -%}
            <a href="/account/login?return_url={{ product.url | url_encode }}" class="login-member-pricing-link">
              <span class="lock-icon">&#128274;</span> Login for Member Pricing
            </a>
          {%- endunless -%}

      {%- endcase -%}

    {%- endif -%}

    <!-- Product Actions - Qty Input + Add to Cart Row -->
    <div class="card-actions">
      {%- if call_for_price -%}
        <a href="{{ product.url }}" class="add-to-cart" style="text-decoration: none; display: block; text-align: center;">
          View Details
        </a>
      {%- elsif product.available -%}
        {%- if show_qty_input and product.variants.size == 1 -%}
          <input
            type="number"
            class="qty-input"
            value="1"
            min="1"
            aria-label="Quantity"
            data-product-id="{{ product.id }}"
          >
          <button
            type="button"
            class="add-to-cart quick-add-btn"
            data-product-id="{{ product.id }}"
            data-variant-id="{{ product.selected_or_first_available_variant.id }}"
          >
            Add to Cart
          </button>
        {%- elsif product.variants.size > 1 -%}
          <a href="{{ product.url }}" class="add-to-cart" style="text-decoration: none; display: block; text-align: center; flex: 1;">
            Select Options
          </a>
        {%- else -%}
          <input
            type="number"
            class="qty-input"
            value="1"
            min="1"
            aria-label="Quantity"
            data-product-id="{{ product.id }}"
          >
          <button
            type="button"
            class="add-to-cart quick-add-btn"
            data-product-id="{{ product.id }}"
            data-variant-id="{{ product.selected_or_first_available_variant.id }}"
          >
            Add to Cart
          </button>
        {%- endif -%}
      {%- else -%}
        <button class="add-to-cart" disabled style="background: #999; cursor: not-allowed; flex: 1;">
          Sold Out
        </button>
      {%- endif -%}
    </div>
  </div>
</div>

<style>
  /* ========== PRODUCT CARD BASE STYLES - L3 DESIGN ========== */
  .product-card {
    background: #ffffff;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    transition: all 0.3s ease;
    border: 1px solid #e2e8f0;
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .product-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 40px rgba(45, 90, 135, 0.12);
    border-color: #2d5a87;
  }

  /* Image Section */
  .product-card .card-image {
    position: relative;
    aspect-ratio: 1 / 1;
    background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    overflow: hidden;
  }

  /* Shine Sweep Effect */
  .product-card .card-image::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 255, 255, 0) 20%,
      rgba(255, 255, 255, 0.5) 50%,
      rgba(255, 255, 255, 0) 80%,
      transparent 100%
    );
    transform: skewX(-25deg);
    z-index: 1;
    transition: left 0.7s ease;
    pointer-events: none;
  }

  .product-card:hover .card-image::before {
    left: 150%;
  }

  .product-card .card-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    transition: transform 0.4s ease, opacity 0.3s ease;
  }

  .product-card:hover .card-image > img:first-of-type {
    transform: scale(1.05);
  }

  .product-card .card-image .product-image-hover {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: calc(100% - 32px);
    max-height: calc(100% - 32px);
    opacity: 0;
  }

  .product-card:hover .card-image .product-image-hover {
    opacity: 1;
  }

  .product-card:hover .card-image img:not(.product-image-hover) {
    opacity: 0;
  }

  /* Badges */
  .product-card .badge-container {
    position: absolute;
    top: 12px;
    left: 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 2;
  }

  .product-card .voltage-badge {
    background: linear-gradient(135deg, #2d5a87 0%, #1a365d 100%);
    color: #ffffff;
    font-size: 10px;
    font-weight: 700;
    padding: 5px 10px;
    border-radius: 4px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .product-card .member-badge {
    background: linear-gradient(135deg, #1a365d 0%, #0f172a 100%);
    color: #ffffff;
    font-size: 9px;
    font-weight: 700;
    padding: 5px 10px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .product-card .badge {
    font-size: 10px;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: 700;
    color: white;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .product-card .low-stock-badge {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  }

  .product-card .new-badge {
    background: linear-gradient(135deg, #1a365d 0%, #2d5a87 100%);
  }

  /* Content Section */
  .product-card .card-content {
    padding: 20px;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .product-card .card-title {
    font-size: 13px;
    font-weight: 600;
    color: #1a365d;
    line-height: 1.4;
    min-height: 54px;
    overflow: hidden;
    margin-bottom: 10px;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    transition: color 0.2s ease;
  }

  .product-card .product-title-link {
    text-decoration: none;
  }

  .product-card .card-title:hover {
    color: #2d5a87;
  }

  /* Rating & SKU */
  .product-card .card-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
    padding-bottom: 12px;
    border-bottom: 1px solid #e2e8f0;
  }

  .product-card .rating {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .product-card .stars {
    color: #d4af37;
    font-size: 12px;
    letter-spacing: -1px;
  }

  .product-card .stars .empty {
    color: #e2e8f0;
  }

  .product-card .sku {
    font-size: 10px;
    font-weight: 600;
    color: #1a365d;
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    padding: 4px 10px;
    border-radius: 4px;
    border: 1px solid rgba(212, 175, 55, 0.3);
  }

  /* ========== PRICING SECTIONS - L3 DESIGN ========== */

  /* PUBLIC VIEW - Single Price (Restricted Products) - Light Gray Box */
  .product-card .price-single {
    text-align: center;
    padding: 10px 8px;
    background: #fafafa;
    border-radius: 6px;
    margin-bottom: 10px;
    border: 1px dotted #d1d5db;
  }

  .product-card .price-label-single {
    font-size: 10px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 4px;
    font-weight: 600;
  }

  .product-card .price-amount-single {
    font-size: 24px;
    font-weight: 800;
    color: #1a365d;
    letter-spacing: -0.5px;
    font-family: 'Montserrat', sans-serif;
  }

  .product-card .price-unit {
    font-size: 12px;
    font-weight: 500;
    color: #64748b;
  }

  /* PUBLIC VIEW - Dual Price (Own Brand Products) - Light Gray Box */
  .product-card .price-dual {
    padding: 10px 8px;
    background: #fafafa;
    border-radius: 6px;
    margin-bottom: 10px;
    position: relative;
    border: 1px dotted #d1d5db;
  }

  .product-card .member-price-label {
    font-size: 10px;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-align: center;
    margin-bottom: 4px;
    font-weight: 600;
  }

  .product-card .member-price-amount {
    font-size: 24px;
    font-weight: 800;
    color: #1a365d;
    text-align: center;
    letter-spacing: -0.5px;
    margin-bottom: 6px;
    font-family: 'Montserrat', sans-serif;
  }

  .product-card .regular-price-strike {
    text-align: center;
    font-size: 12px;
    color: #64748b;
  }

  .product-card .regular-price-strike s {
    text-decoration: line-through;
  }

  .product-card .savings-tag {
    text-align: center;
    font-size: 10px;
    color: #dc2626;
    font-weight: 600;
    margin-top: 4px;
  }

  /* MEMBER VIEW - Light Gray Box with dotted border (matching L3) */
  .product-card .price-member-view {
    background: #fafafa;
    border-radius: 6px;
    padding: 10px 8px;
    margin-bottom: 10px;
    position: relative;
    border: 1px dotted #d1d5db;
  }

  .product-card .price-member-view::after {
    display: none;
  }

  .product-card .member-view-price {
    font-size: 24px;
    font-weight: 800;
    color: #1a365d;
    text-align: center;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
    font-family: 'Montserrat', sans-serif;
  }

  .product-card .member-view-regular {
    text-align: center;
    font-size: 12px;
    color: #64748b;
    margin-bottom: 4px;
  }

  .product-card .member-view-regular s {
    text-decoration: line-through;
  }

  .product-card .member-view-savings {
    text-align: center;
    font-size: 10px;
    color: #dc2626;
    font-weight: 600;
  }

  /* Login for Member Pricing Link */
  .product-card .login-member-pricing-link {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 11px;
    font-weight: 600;
    color: #2d5a87;
    text-decoration: none;
    padding: 8px 10px;
    background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
    border: 1px solid rgba(45, 90, 135, 0.2);
    border-radius: 6px;
    margin-bottom: 12px;
    transition: all 0.2s ease;
  }

  .product-card .login-member-pricing-link:hover {
    background: linear-gradient(135deg, #bfdbfe 0%, #dbeafe 100%);
    color: #1a365d;
    border-color: rgba(45, 90, 135, 0.3);
  }

  .product-card .login-member-pricing-link .lock-icon {
    font-size: 12px;
  }

  /* ========== ACTION BUTTONS - L3 DESIGN ========== */
  .product-card .card-actions {
    display: flex;
    gap: 10px;
    margin-top: auto;
  }

  .product-card .qty-input {
    width: 50px;
    height: 42px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    text-align: center;
    font-size: 14px;
    font-weight: 600;
    color: #0f172a;
    transition: border-color 0.2s ease;
  }

  .product-card .qty-input:focus {
    outline: none;
    border-color: #2d5a87;
  }

  .product-card .add-to-cart {
    flex: 1;
    height: 42px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ef4444 100%);
    color: #ffffff;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .product-card .add-to-cart:hover {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
  }

  .product-card .add-to-cart:disabled {
    background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .product-card .add-to-cart.added {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
  }

  /* Wishlist Button */
  .product-card .wishlist-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2;
    transition: all 0.2s ease;
  }

  .product-card .wishlist-btn svg {
    width: 16px;
    height: 16px;
    color: #ccc;
    transition: color 0.2s ease;
  }

  .product-card .wishlist-btn:hover {
    border-color: #ff6b6b;
  }

  .product-card .wishlist-btn:hover svg {
    color: #ff6b6b;
  }

  .product-card .wishlist-btn.active svg {
    color: #ff6b6b;
  }

  /* Product link */
  .product-card .product-link {
    text-decoration: none;
    display: block;
  }

  /* Wishlist Button - L3 Design */
  .product-card .wishlist-btn {
    position: absolute;
    top: 12px;
    right: 12px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 2;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }

  .product-card .wishlist-btn:hover {
    border-color: #ff6b6b;
    transform: scale(1.1);
  }

  .product-card .wishlist-btn svg {
    width: 18px;
    height: 18px;
    color: #cbd5e1;
    transition: color 0.2s ease;
  }

  .product-card .wishlist-btn:hover svg {
    color: #ff6b6b;
  }

  .product-card .wishlist-btn.active svg {
    color: #ff6b6b;
  }

  /* ========== RESPONSIVE - L3 DESIGN ========== */
  @media (max-width: 992px) {
    .product-card .card-content {
      padding: 16px;
    }

    .product-card .card-title {
      font-size: 12px;
      min-height: 48px;
    }
  }

  @media (max-width: 768px) {
    .product-card .price-amount-single {
      font-size: 22px;
    }

    .product-card .member-price-amount {
      font-size: 24px;
    }

    .product-card .member-view-price {
      font-size: 24px;
    }

    .product-card .card-actions {
      flex-direction: column;
      gap: 8px;
    }

    .product-card .qty-input {
      width: 100%;
    }
  }
</style>

<script>
  // Quick add functionality with quantity support
  document.querySelectorAll('.product-card .quick-add-btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      const variantId = this.dataset.variantId;
      const productId = this.dataset.productId;

      // Find the quantity input in the same card-actions
      const cardActions = this.closest('.card-actions');
      let quantity = 1;
      if (cardActions) {
        const qtyInput = cardActions.querySelector('.qty-input');
        if (qtyInput) {
          quantity = parseInt(qtyInput.value, 10) || 1;
        }
      }

      // Disable button during request
      this.disabled = true;
      const originalText = this.innerHTML;
      this.innerHTML = 'Adding...';

      fetch('/cart/add.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          id: variantId,
          quantity: quantity
        })
      })
      .then(response => response.json())
      .then(data => {
        // Update cart count
        fetch('/cart.js')
          .then(res => res.json())
          .then(cart => {
            const cartCount = document.querySelector('.cart-count');
            if (cartCount) {
              cartCount.textContent = cart.item_count;
            }
          });

        // Show success message
        this.innerHTML = 'Added!';
        this.classList.add('added');

        setTimeout(() => {
          this.innerHTML = 'Add to Cart';
          this.classList.remove('added');
          this.disabled = false;
        }, 2000);
      })
      .catch(error => {
        console.error('Error:', error);
        this.innerHTML = 'Error';
        setTimeout(() => {
          this.innerHTML = 'Add to Cart';
          this.disabled = false;
        }, 2000);
      });
    });
  });

  // Quantity input validation
  document.querySelectorAll('.product-card .qty-input').forEach(input => {
    input.addEventListener('change', function() {
      let value = parseInt(this.value, 10);
      if (isNaN(value) || value < 1) {
        this.value = 1;
      }
    });
  });
</script>
