{%- liquid
  assign main_menu = section.settings.main_menu | default: 'main-menu'
  assign menu = linklists[main_menu]
  assign header_bg_color = section.settings.header_bg_color | default: '#1a365d'
  assign header_overlay_color = section.settings.header_overlay_color | default: 'rgba(26, 54, 93, 0.85)'
-%}

<style>
  .collections-hub {
    --cf-deep-blue: #1a365d;
    --cf-navy: #2d5a87;
    --cf-coral: #ff6b6b;
    --cf-text-dark: #0f172a;
    --cf-text-medium: #475569;
    --cf-border: #e2e8f0;
    --cf-bg-light: #f8fafc;
  }

  /* Breadcrumb */
  .collections-breadcrumb {
    padding: 16px 40px;
    background: var(--cf-bg-light);
    border-bottom: 1px solid var(--cf-border);
  }
  .collections-breadcrumb nav {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    color: var(--cf-text-medium);
  }
  .collections-breadcrumb a {
    color: var(--cf-navy);
    text-decoration: none;
  }
  .collections-breadcrumb a:hover {
    color: var(--cf-coral);
  }

  /* Hero Header */
  .collections-hero {
    background: linear-gradient(135deg, {{ header_bg_color }} 0%, #0f172a 100%);
    padding: 50px 40px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .collections-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.5;
  }
  .collections-hero-content {
    position: relative;
    z-index: 1;
  }
  .collections-hero h1 {
    font-family: 'Montserrat', sans-serif;
    font-size: 36px;
    font-weight: 800;
    color: white;
    margin: 0 0 12px;
  }
  .collections-hero p {
    font-size: 16px;
    color: rgba(255,255,255,0.8);
    max-width: 600px;
    margin: 0 auto;
  }

  /* Main Categories Section */
  .collections-section {
    padding: 40px;
  }

  /* L1 Category Grid - 3 columns */
  .l1-categories-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 28px;
  }
  @media (max-width: 992px) {
    .l1-categories-grid { grid-template-columns: repeat(2, 1fr); }
  }
  @media (max-width: 576px) {
    .l1-categories-grid { grid-template-columns: 1fr; }
    .collections-section { padding: 24px 16px; }
    .collections-hero { padding: 30px 16px; }
    .collections-hero h1 { font-size: 26px; }
  }

  /* L1 Category Card */
  .l1-category-card {
    background: white;
    border: 1px solid var(--cf-border);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
  }
  .l1-category-card:hover {
    border-color: var(--cf-navy);
    box-shadow: 0 8px 24px rgba(26, 54, 93, 0.12);
    transform: translateY(-4px);
  }

  .l1-card-image {
    display: block;
    width: 100%;
    aspect-ratio: 16 / 9;
    position: relative;
    overflow: hidden;
    background: var(--cf-bg-light);
  }
  .l1-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }
  .l1-category-card:hover .l1-card-image img {
    transform: scale(1.05);
  }
  .l1-card-image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(26, 54, 93, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .l1-category-card:hover .l1-card-image-overlay {
    opacity: 1;
  }
  .l1-card-image-overlay span {
    color: white;
    font-weight: 700;
    font-size: 16px;
    text-align: center;
    padding: 0 16px;
  }
  .l1-card-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    color: #94a3b8;
    font-size: 48px;
  }

  .l1-card-content {
    padding: 20px;
  }
  .l1-card-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--cf-deep-blue);
    margin: 0 0 8px;
  }
  .l1-card-title a {
    color: inherit;
    text-decoration: none;
  }
  .l1-card-title a:hover {
    color: var(--cf-coral);
  }

  .l1-card-count {
    font-size: 12px;
    font-weight: 600;
    color: var(--cf-coral);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 12px;
  }
  .l1-card-count::after {
    content: '→';
    transition: transform 0.3s ease;
  }
  .l1-category-card:hover .l1-card-count::after {
    transform: translateX(4px);
  }

  /* Subcategories List */
  .l1-subcategories {
    list-style: none;
    padding: 14px 0 0;
    margin: 0;
    border-top: 1px solid var(--cf-border);
  }
  .l1-subcategories li {
    margin-bottom: 8px;
  }
  .l1-subcategories li:last-child {
    margin-bottom: 0;
  }
  .l1-subcategories a {
    font-size: 13px;
    color: var(--cf-navy);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s ease;
  }
  .l1-subcategories a::before {
    content: '';
    width: 4px;
    height: 4px;
    background: var(--cf-navy);
    border-radius: 50%;
    flex-shrink: 0;
  }
  .l1-subcategories a:hover {
    color: var(--cf-coral);
    padding-left: 4px;
  }
  .l1-subcategories a:hover::before {
    background: var(--cf-coral);
  }

  /* Brands Section */
  .brands-section {
    background: var(--cf-bg-light);
    padding: 40px;
    border-top: 1px solid var(--cf-border);
  }
  .brands-section-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--cf-deep-blue);
    margin: 0 0 24px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .brands-section-title::before {
    content: '';
    width: 4px;
    height: 24px;
    background: linear-gradient(180deg, var(--cf-coral) 0%, var(--cf-navy) 100%);
    border-radius: 2px;
  }
  .brands-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 16px;
  }
  @media (max-width: 1200px) {
    .brands-grid { grid-template-columns: repeat(5, 1fr); }
  }
  @media (max-width: 992px) {
    .brands-grid { grid-template-columns: repeat(4, 1fr); }
  }
  @media (max-width: 576px) {
    .brands-grid { grid-template-columns: repeat(3, 1fr); }
    .brands-section { padding: 24px 16px; }
  }
  .brand-item {
    background: white;
    border: 1px solid var(--cf-border);
    border-radius: 8px;
    padding: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    aspect-ratio: 1 / 1;
    transition: all 0.3s ease;
    text-decoration: none;
  }
  .brand-item:hover {
    border-color: var(--cf-navy);
    box-shadow: 0 4px 12px rgba(26, 54, 93, 0.1);
    transform: translateY(-2px);
  }
  .brand-item img {
    max-width: 80%;
    max-height: 80%;
    object-fit: contain;
  }
  .brand-item span {
    font-size: 12px;
    font-weight: 600;
    color: var(--cf-text-medium);
    text-align: center;
    line-height: 1.3;
  }
</style>

<!-- Breadcrumb -->
{%- if section.settings.show_breadcrumbs -%}
<section class="collections-breadcrumb">
  <nav aria-label="breadcrumbs">
    <a href="{{ routes.root_url }}">Home</a>
    <span>›</span>
    <span>All Categories</span>
  </nav>
</section>
{%- endif -%}

<!-- Hero Header -->
<section class="collections-hero">
  <div class="collections-hero-content">
    <h1>{{ section.settings.title | default: 'Shop by Category' }}</h1>
    <p>{{ section.settings.description | default: 'Browse our complete selection of professional restaurant equipment, kitchen supplies, and commercial-grade products.' }}</p>
  </div>
</section>

<!-- Main Categories Grid -->
<section class="collections-section collections-hub">
  <div class="l1-categories-grid">
    {%- for link in menu.links -%}
      {%- comment %} Show menu items that have subcategories {% endcomment -%}
      {%- if link.links.size > 0 -%}
        {%- assign link_handle = link.url | split: '/' | last | split: '?' | first -%}
        {%- assign link_collection = collections[link_handle] -%}

        {%- comment %} Fallback: Try with "new-theme-" prefix {% endcomment -%}
        {%- unless link_collection.products_count > 0 or link_collection.all_products_count > 0 -%}
          {%- assign new_theme_handle = 'new-theme-' | append: link_handle -%}
          {%- assign temp_collection = collections[new_theme_handle] -%}
          {%- if temp_collection.products_count > 0 or temp_collection.all_products_count > 0 -%}
            {%- assign link_collection = temp_collection -%}
          {%- endif -%}
        {%- endunless -%}

        {%- assign card_image = link_collection.image | default: link_collection.products.first.featured_image -%}
        {%- assign clean_title = link.title | remove: 'New Theme - ' | remove: 'New Theme- ' -%}

        <div class="l1-category-card">
          <a href="{{ link.url }}" class="l1-card-image">
            {%- if card_image -%}
              <img
                src="{{ card_image | image_url: width: 800, height: 450, crop: 'center' }}"
                alt="{{ clean_title | escape }}"
                loading="lazy"
                width="800"
                height="450"
              >
            {%- else -%}
              <div class="l1-card-placeholder">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5-7l-3 3.72L9 13l-3 4h12l-4-5z"/>
                </svg>
              </div>
            {%- endif -%}
            <div class="l1-card-image-overlay">
              <span>{{ clean_title }}</span>
            </div>
          </a>

          <div class="l1-card-content">
            <h3 class="l1-card-title">
              <a href="{{ link.url }}">{{ clean_title }}</a>
            </h3>

            {%- if link.links.size > 0 -%}
              <a href="{{ link.url }}" class="l1-card-count">
                Shop {{ link.links.size }} Categories
              </a>

              <ul class="l1-subcategories">
                {%- for child_link in link.links limit: 5 -%}
                  {%- assign child_title = child_link.title | remove: 'New Theme - ' | remove: 'New Theme- ' -%}
                  <li><a href="{{ child_link.url }}">{{ child_title }}</a></li>
                {%- endfor -%}
              </ul>
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
</section>

<!-- Top Brands Section (from Excel sheet) -->
{%- comment %}
  Top Brands from: Suggested Navigation Structure to Rajesh.xlsx > Shop By Brands
  Links use vendor filter: /collections/vendors?q={brand_name}
{% endcomment -%}
<section class="brands-section collections-hub">
  <h2 class="brands-section-title">Top Brands</h2>
  <div class="brands-grid">
    {%- assign top_brands = 'ATOSA,GSW,THUNDER GROUP,RATIONAL,ROBOT COUPE,CAC,TURBO AIR,WARING,EURODIB,WINCO,SAMMIC,GLOBE,SHAAN,SOMERSET,GLOBAL SOLUTIONS,ROTOQUIP,KWITEX,YANCO' | split: ',' -%}

    {%- for brand in top_brands -%}
      {%- assign brand_slug = brand | downcase | replace: ' ', '+' -%}
      {%- assign brand_url = '/collections/vendors?q=' | append: brand_slug -%}

      <a href="{{ brand_url }}" class="brand-item">
        {%- comment %} Try to render brand logo if asset exists {% endcomment -%}
        {%- assign logo_file = 'brand-logo-' | append: brand | downcase | replace: ' ', '-' | append: '.png' -%}
        {%- assign logo_url = logo_file | asset_url -%}
        {%- if logo_url contains 'cdn.shopify' -%}
          <img
            src="{{ logo_url }}"
            alt="{{ brand }}"
            loading="lazy"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
          >
          <span style="display:none;">{{ brand }}</span>
        {%- else -%}
          <span>{{ brand }}</span>
        {%- endif -%}
      </a>
    {%- endfor -%}
  </div>
</section>

{% schema %}
{
  "name": "Collections Hub",
  "tag": "section",
  "class": "section-collections-hub",
  "settings": [
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main menu",
      "default": "main-menu",
      "info": "Select the menu that contains your L1 categories"
    },
    {
      "type": "header",
      "content": "Breadcrumbs"
    },
    {
      "type": "checkbox",
      "id": "show_breadcrumbs",
      "default": true,
      "label": "Show breadcrumbs"
    },
    {
      "type": "header",
      "content": "Hero Header"
    },
    {
      "type": "text",
      "id": "title",
      "default": "Shop by Category",
      "label": "Heading"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Browse our complete selection of professional restaurant equipment, kitchen supplies, and commercial-grade products."
    },
    {
      "type": "color",
      "id": "header_bg_color",
      "default": "#1a365d",
      "label": "Header background color"
    },
    {
      "type": "image_picker",
      "id": "header_bg_image",
      "label": "Header background image"
    },
    {
      "type": "color",
      "id": "header_overlay_color",
      "default": "rgba(26, 54, 93, 0.85)",
      "label": "Header overlay color"
    }
  ],
  "presets": [
    {
      "name": "Collections Hub"
    }
  ]
}
{% endschema %}
