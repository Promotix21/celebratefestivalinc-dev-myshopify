{{ 'product-webstaurant-improved.css' | asset_url | stylesheet_tag }}

{% comment %}
==================================================
PRODUCT PAGE - WEBSTAURANTSTORE STYLE (COMPLETE)
==================================================
Version: 2.0 - Complete implementation
Features:
- Complete WebstaurantStore design replication
- Demo data toggle for ALL sections
- Vertical thumbnail gallery
- All interactive features
- Accordion sections
- Works With carousel
- Specifications table
- Full Shopify integration
==================================================
{% endcomment %}

{%- liquid
  assign current_variant = product.selected_or_first_available_variant
  assign product_form_id = 'product-form-' | append: section.id
  assign demo_mode = section.settings.show_demo_data
-%}

<div class="product-webstaurant-container{% if demo_mode %} demo-mode{% endif %}">

  {%- comment -%} ===== DEMO MODE BANNER ===== {%- endcomment -%}
  {% if demo_mode %}
    <div class="demo-mode-banner">
      ⚠️ DEMO MODE ACTIVE - Showing Example Data | <a href="#" onclick="alert('Turn off \\'Show Demo Data\\' in theme customizer settings'); return false;">Click to disable</a>
    </div>
  {% endif %}

  {%- comment -%} ===== MAIN PRODUCT GRID ===== {%- endcomment -%}
  <div class="product-main-wrapper">

    {%- comment -%} ===== LEFT COLUMN: Product Info ===== {%- endcomment -%}
    <div class="product-content-left">

      {%- comment -%} Product Header {%- endcomment -%}
      <div class="product-header">
        <h1 class="product-title">{{ product.title }}</h1>

        <div class="product-meta-row">
          {%- comment -%} Item Number {%- endcomment -%}
          <span class="product-sku">
            Item #: {{ current_variant.sku | default: product.id }}
          </span>

          {%- comment -%} Star Rating {%- endcomment -%}
          {% if product.metafields.reviews.rating or demo_mode %}
            <div class="product-rating">
              {% if demo_mode and product.metafields.reviews.rating == blank %}
                {%- assign rating = 4.2 -%}
                {%- assign review_count = 47 -%}
              {% else %}
                {%- assign rating = product.metafields.reviews.rating | times: 1.0 -%}
                {%- assign review_count = product.metafields.reviews.count | default: 0 -%}
              {% endif %}

              {%- assign rating_floor = rating | floor -%}
              <div class="stars">
                {% for i in (1..5) %}
                  {% if i <= rating_floor %}
                    <span class="star filled">★</span>
                  {% else %}
                    <span class="star empty">★</span>
                  {% endif %}
                {% endfor %}
              </div>
              <a href="#reviews-section" class="reviews-link">
                Read {{ review_count }} reviews
              </a>
            </div>
          {% endif %}
        </div>
      </div>

      {%- comment -%} ===== IMAGE GALLERY WITH VERTICAL THUMBNAILS ===== {%- endcomment -%}
      <div class="product-gallery-section">
        <div class="gallery-container">

          {%- comment -%} Vertical Thumbnail Strip (LEFT) {%- endcomment -%}
          <div class="product-thumbnail-gallery">
            {% if product.images.size > 0 %}
              {% for image in product.images limit: 10 %}
                <div class="thumbnail-item {% if forloop.first %}active{% endif %}"
                     data-image-url="{{ image | img_url: '1000x1000' }}"
                     data-image-id="{{ image.id }}">
                  <img src="{{ image | img_url: '100x100' }}"
                       alt="{{ image.alt | escape }}"
                       width="80"
                       height="80"
                       loading="{% if forloop.index <= 3 %}eager{% else %}lazy{% endif %}">
                </div>
              {% endfor %}
            {% elsif demo_mode %}
              {%- comment -%} Demo thumbnails {%- endcomment -%}
              {% for i in (1..5) %}
                <div class="thumbnail-item {% if forloop.first %}active{% endif %}"
                     data-demo="true">
                  <div class="demo-thumb">{{ i }}</div>
                </div>
              {% endfor %}
            {% endif %}

            {%- comment -%} Video Thumbnail {%- endcomment -%}
            {% if product.metafields.custom.product_video_url or demo_mode %}
              <div class="thumbnail-item video-thumb" data-video="true">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="currentColor">
                  <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <span class="video-label">Video</span>
              </div>
            {% endif %}
          </div>

          {%- comment -%} Main Product Image {%- endcomment -%}
          <div class="product-main-image">
            {% if product.featured_image %}
              <img src="{{ product.featured_image | img_url: '1000x1000' }}"
                   alt="{{ product.featured_image.alt | escape }}"
                   id="main-product-image"
                   class="main-image"
                   width="1000"
                   height="1000"
                   loading="eager">
            {% elsif demo_mode %}
              <div class="demo-main-image">
                <svg width="200" height="200" viewBox="0 0 200 200">
                  <rect width="200" height="200" fill="#f0f0f0"/>
                  <text x="100" y="100" text-anchor="middle" font-size="16" fill="#999">Product Image</text>
                </svg>
              </div>
            {% else %}
              <div class="no-image-placeholder">
                <p>No image available</p>
              </div>
            {% endif %}

            <button class="zoom-button" aria-label="Zoom image">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
                <line x1="11" y1="8" x2="11" y2="14"></line>
                <line x1="8" y1="11" x2="14" y2="11"></line>
              </svg>
            </button>
          </div>

        </div>
      </div>

      {%- comment -%} Product Action Buttons {%- endcomment -%}
      <div class="product-actions-bottom">
        <button class="btn-action" onclick="shareProduct()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
          Share
        </button>
        <button class="btn-action">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          Ask Question
        </button>
        <button class="btn-action">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          Request Consultation
        </button>
      </div>

      {%- comment -%} ===== PRODUCT DESCRIPTION & FEATURES ===== {%- endcomment -%}
      <div class="product-description-section">
        {% if product.description != blank or demo_mode %}
          <h2 class="section-heading">Product Description</h2>
          <div class="product-description-content">
            {% if demo_mode and product.description == blank %}
              <p>This premium commercial-grade equipment is designed for professional food service operations. Built with durability and performance in mind, it delivers consistent results in demanding kitchen environments.</p>
              <p>Key highlights include energy-efficient operation, easy maintenance, and compliance with industry standards. Perfect for restaurants, catering businesses, and institutional kitchens.</p>
            {% else %}
              {{ product.description }}
            {% endif %}
          </div>
        {% endif %}
      </div>

      {%- comment -%} ===== FEATURE SECTIONS (ACCORDION) ===== {%- endcomment -%}
      {% if product.metafields.custom.features or demo_mode %}
        <div class="features-section">
          <h2 class="section-heading">Features & Benefits</h2>

          {% if demo_mode and product.metafields.custom.features == blank %}
            {%- comment -%} Demo Features {%- endcomment -%}
            <div class="feature-accordion">
              <div class="accordion-item">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                  <span>Durable Construction</span>
                  <svg class="accordion-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>
                <div class="accordion-content">
                  <div class="feature-content">
                    <img src="https://via.placeholder.com/150x150?text=Feature" alt="Durable Construction" class="feature-image">
                    <div class="feature-text">
                      <p>Constructed with heavy-duty stainless steel for long-lasting performance in commercial environments. Corrosion-resistant and easy to clean.</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="accordion-item">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                  <span>Energy Efficient Operation</span>
                  <svg class="accordion-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>
                <div class="accordion-content">
                  <div class="feature-content">
                    <img src="https://via.placeholder.com/150x150?text=Energy" alt="Energy Efficient" class="feature-image">
                    <div class="feature-text">
                      <p>Advanced insulation and efficient compressor system reduce energy consumption while maintaining optimal performance. Saves money on utility costs.</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="accordion-item">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                  <span>Easy Maintenance</span>
                  <svg class="accordion-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>
                <div class="accordion-content">
                  <div class="feature-content">
                    <img src="https://via.placeholder.com/150x150?text=Maintenance" alt="Easy Maintenance" class="feature-image">
                    <div class="feature-text">
                      <p>Removable components and accessible design make cleaning and maintenance simple. Reduce downtime and keep your equipment running smoothly.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            {%- comment -%} Real product features from metafield {%- endcomment -%}
            <div class="feature-accordion">
              {{ product.metafields.custom.features }}
            </div>
          {% endif %}
        </div>
      {% endif %}

      {%- comment -%} ===== SPECIFICATIONS TABLE ===== {%- endcomment -%}
      {% if product.metafields.custom.specifications or demo_mode %}
        <div class="specifications-section">
          <h2 class="section-heading">Specifications</h2>

          <table class="specs-table">
            {% if demo_mode and product.metafields.custom.specifications == blank %}
              <tr>
                <td class="spec-label">Width</td>
                <td class="spec-value">54 inches</td>
              </tr>
              <tr>
                <td class="spec-label">Depth</td>
                <td class="spec-value">32 inches</td>
              </tr>
              <tr>
                <td class="spec-label">Height</td>
                <td class="spec-value">78 inches</td>
              </tr>
              <tr>
                <td class="spec-label">Capacity</td>
                <td class="spec-value">49 cubic feet</td>
              </tr>
              <tr>
                <td class="spec-label">Voltage</td>
                <td class="spec-value">115V</td>
              </tr>
              <tr>
                <td class="spec-label">Wattage</td>
                <td class="spec-value">1200 Watts</td>
              </tr>
              <tr>
                <td class="spec-label">Temperature Range</td>
                <td class="spec-value">-10°F to 0°F</td>
              </tr>
              <tr>
                <td class="spec-label">Material</td>
                <td class="spec-value">Stainless Steel</td>
              </tr>
              <tr>
                <td class="spec-label">Door Type</td>
                <td class="spec-value">Solid, Self-Closing</td>
              </tr>
              <tr>
                <td class="spec-label">Shelves</td>
                <td class="spec-value">6 Adjustable</td>
              </tr>
              <tr>
                <td class="spec-label">Refrigerant</td>
                <td class="spec-value">R-290</td>
              </tr>
              <tr>
                <td class="spec-label">Certification</td>
                <td class="spec-value">ETL, NSF</td>
              </tr>
              <tr>
                <td class="spec-label">Weight</td>
                <td class="spec-value">385 lbs</td>
              </tr>
              <tr>
                <td class="spec-label">Warranty</td>
                <td class="spec-value">3 Years Parts & Labor</td>
              </tr>
            {% else %}
              {%- comment -%} Real specifications {%- endcomment -%}
              {{ product.metafields.custom.specifications }}
            {% endif %}
          </table>
        </div>
      {% endif %}

      {%- comment -%} ===== CERTIFICATIONS & COMPLIANCE ===== {%- endcomment -%}
      {% if product.metafields.custom.certifications or demo_mode %}
        <div class="certifications-section">
          <h3>Certifications & Compliance</h3>
          <div class="cert-badges">
            {% if demo_mode and product.metafields.custom.certifications == blank %}
              <div class="cert-badge">
                <img src="https://via.placeholder.com/80x80?text=ETL" alt="ETL Certified">
                <span>ETL Listed</span>
              </div>
              <div class="cert-badge">
                <img src="https://via.placeholder.com/80x80?text=NSF" alt="NSF Certified">
                <span>NSF Certified</span>
              </div>
              <div class="cert-badge">
                <img src="https://via.placeholder.com/80x80?text=ENERGY" alt="Energy Star">
                <span>Energy Star</span>
              </div>
            {% else %}
              {{ product.metafields.custom.certifications }}
            {% endif %}
          </div>
        </div>
      {% endif %}

    </div>

    {%- comment -%} ===== RIGHT SIDEBAR: Purchase Panel ===== {%- endcomment -%}
    <div class="product-sidebar-right">

      {%- comment -%} Free Shipping Badge {%- endcomment -%}
      {% if section.settings.show_free_shipping or demo_mode %}
        <div class="free-shipping-badge">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="3" width="15" height="13"></rect>
            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
            <circle cx="5.5" cy="18.5" r="2.5"></circle>
            <circle cx="18.5" cy="18.5" r="2.5"></circle>
          </svg>
          <span>Free Shipping</span>
        </div>
      {% endif %}

      {%- comment -%} Pricing {%- endcomment -%}
      <div class="pricing-section">
        {% if demo_mode and product.price == 0 %}
          <div class="price-regular">
            <span class="price-label">Regularly:</span>
            <span class="price-amount">$2,619.00</span>
            <span class="price-unit">/Each</span>
          </div>
          <div class="price-member">
            <span class="member-badge">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
              </svg>
              Plus Member
            </span>
            <span class="price-amount-member">$2,469.00</span>
            <span class="price-unit">/Each</span>
          </div>
        {% else %}
          <div class="price-regular">
            <span class="price-label">Price:</span>
            <span class="price-amount">{{ current_variant.price | money }}</span>
            {% if product.price_varies %}
              <span class="price-varies">+</span>
            {% endif %}
          </div>
          {% if current_variant.compare_at_price > current_variant.price %}
            <div class="price-compare">
              <span class="compare-label">Regularly:</span>
              <span class="compare-amount">{{ current_variant.compare_at_price | money }}</span>
            </div>
          {% endif %}
        {% endif %}
      </div>

      {%- comment -%} Protection Plan {%- endcomment -%}
      {% if section.settings.show_protection_plan or demo_mode %}
        <div class="protection-plan-section">
          <h4>Protect Your Investment</h4>
          <select class="protection-select">
            <option value="">No Protection Plan</option>
            <option value="1year">1 Year Protection - $89.99</option>
            <option value="2year">2 Years Protection - $159.99</option>
            <option value="3year">3 Years Protection - $229.99</option>
          </select>
          <p class="protection-note">Covers parts, labor, and shipping</p>
        </div>
      {% endif %}

      {%- comment -%} Variant Selector {%- endcomment -%}
      {% if product.has_only_default_variant == false %}
        <div class="variant-selector-section">
          {% for option in product.options_with_values %}
            <div class="variant-option-group">
              <label class="variant-label">{{ option.name }}:</label>
              <select class="variant-select"
                      name="option{{ forloop.index }}"
                      data-option-index="{{ forloop.index0 }}">
                {% for value in option.values %}
                  <option value="{{ value | escape }}"
                          {% if option.selected_value == value %}selected{% endif %}>
                    {{ value }}
                  </option>
                {% endfor %}
              </select>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      {%- comment -%} Quantity & Add to Cart {%- endcomment -%}
      <form method="post" action="/cart/add" id="{{ product_form_id }}" class="product-form">
        <input type="hidden" name="id" value="{{ current_variant.id }}">

        <div class="quantity-cart-section">
          <div class="quantity-selector">
            <label for="quantity-input" class="quantity-label">Quantity:</label>
            <div class="quantity-controls">
              <button type="button" class="qty-btn" onclick="decreaseQuantity()">−</button>
              <input type="number"
                     id="quantity-input"
                     name="quantity"
                     value="1"
                     min="1"
                     class="qty-input">
              <button type="button" class="qty-btn" onclick="increaseQuantity()">+</button>
            </div>
          </div>

          <button type="submit"
                  class="btn-add-to-cart"
                  {% unless current_variant.available %}disabled{% endunless %}
                  onclick="addToCart(event)">
            <span class="btn-text">
              {% if current_variant.available %}
                Add to Cart
              {% else %}
                Sold Out
              {% endif %}
            </span>
            <span class="loading-spinner hidden">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
              </svg>
            </span>
          </button>
        </div>
      </form>

      {%- comment -%} Rewards Info {%- endcomment -%}
      {% if section.settings.show_rewards or demo_mode %}
        <div class="rewards-info">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
          </svg>
          {% if demo_mode %}
            <span>Earn <strong>2,619 Rewards Points</strong> with this purchase</span>
          {% else %}
            <span>Earn rewards with this purchase</span>
          {% endif %}
        </div>
      {% endif %}

      {%- comment -%} Wishlist {%- endcomment -%}
      <button class="btn-wishlist" onclick="addToWishlist({{ product.id }})">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span>Add to Wish List</span>
      </button>

      {%- comment -%} Shipping & Returns {%- endcomment -%}
      <div class="shipping-returns-info">
        <div class="info-item">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="1" y="3" width="15" height="13"></rect>
            <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
            <circle cx="5.5" cy="18.5" r="2.5"></circle>
            <circle cx="18.5" cy="18.5" r="2.5"></circle>
          </svg>
          <div class="info-text">
            <strong>Quick Shipping</strong>
            <p>Usually ships in 1-2 business days</p>
          </div>
        </div>
        <div class="info-item">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
          <div class="info-text">
            <strong>Easy Returns</strong>
            <p>30-day return policy</p>
          </div>
        </div>
      </div>

    </div>

  </div>

  {%- comment -%} ===== WORKS WITH SECTION ===== {%- endcomment -%}
  {% if product.metafields.custom.works_with_products or demo_mode %}
    <div class="works-with-section">
      <h2 class="section-heading">Works Great With</h2>
      <p class="section-subtitle">Customers who bought this item also bought:</p>

      <div class="carousel-wrapper">
        <button class="carousel-nav prev" onclick="scrollCarousel('prev', 'works-with')" aria-label="Previous">‹</button>

        <div class="works-with-carousel">
          {% if demo_mode and product.metafields.custom.works_with_products == blank %}
            {%- comment -%} Demo products {%- endcomment -%}
            {% for i in (1..8) %}
              <div class="product-card-mini">
                <div class="mini-image">
                  <img src="https://via.placeholder.com/200x200?text=Product+{{ i }}" alt="Related Product {{ i }}">
                </div>
                <h4 class="mini-title">Accessory Item {{ i }}</h4>
                <p class="mini-price">$89.99</p>
                <button class="btn-quick-add" data-product-id="demo-{{ i }}">Quick Add</button>
              </div>
            {% endfor %}
          {% else %}
            {%- comment -%} Real related products {%- endcomment -%}
            {{ product.metafields.custom.works_with_products }}
          {% endif %}
        </div>

        <button class="carousel-nav next" onclick="scrollCarousel('next', 'works-with')" aria-label="Next">›</button>
      </div>
    </div>
  {% endif %}

  {%- comment -%} ===== PRODUCT RECOMMENDATIONS ===== {%- endcomment -%}
  <div class="recommendations-section">
    <h2 class="section-heading">You Might Also Like</h2>

    <div class="carousel-wrapper">
      <button class="carousel-nav prev" onclick="scrollCarousel('prev', 'recommendations')" aria-label="Previous">‹</button>

      <div class="related-items-carousel">
        {% if recommendations.products_count > 0 %}
          {% for product in recommendations.products limit: 8 %}
            <div class="product-card-mini">
              <div class="mini-image">
                {% if product.featured_image %}
                  <img src="{{ product.featured_image | img_url: '200x200' }}" alt="{{ product.title | escape }}">
                {% endif %}
              </div>
              <h4 class="mini-title">{{ product.title }}</h4>
              <p class="mini-price">{{ product.price | money }}</p>
              <a href="{{ product.url }}" class="btn-quick-view">View Product</a>
            </div>
          {% endfor %}
        {% elsif demo_mode %}
          {% for i in (1..6) %}
            <div class="product-card-mini">
              <div class="mini-image">
                <img src="https://via.placeholder.com/200x200?text=Recommend+{{ i }}" alt="Recommended {{ i }}">
              </div>
              <h4 class="mini-title">Recommended Product {{ i }}</h4>
              <p class="mini-price">${{ i }}49.99</p>
              <a href="#" class="btn-quick-view">View Product</a>
            </div>
          {% endfor %}
        {% endif %}
      </div>

      <button class="carousel-nav next" onclick="scrollCarousel('next', 'recommendations')" aria-label="Next">›</button>
    </div>
  </div>

</div>

{%- comment -%} ===== JAVASCRIPT ===== {%- endcomment -%}
<script>
document.addEventListener('DOMContentLoaded', function() {

  // ============================
  // IMAGE GALLERY
  // ============================
  const mainImage = document.getElementById('main-product-image');
  const thumbnails = document.querySelectorAll('.thumbnail-item');

  thumbnails.forEach(thumb => {
    thumb.addEventListener('click', function() {
      if (this.dataset.video) {
        console.log('Video thumbnail clicked');
        return;
      }

      const newImageUrl = this.dataset.imageUrl;
      if (newImageUrl && mainImage) {
        mainImage.src = newImageUrl;
      }

      thumbnails.forEach(t => t.classList.remove('active'));
      this.classList.add('active');
    });
  });

  // Zoom button
  const zoomButton = document.querySelector('.zoom-button');
  if (zoomButton) {
    zoomButton.addEventListener('click', function() {
      if (mainImage && mainImage.src) {
        window.open(mainImage.src, '_blank');
      }
    });
  }

  // ============================
  // QUANTITY CONTROLS
  // ============================
  window.increaseQuantity = function() {
    const input = document.getElementById('quantity-input');
    if (input) {
      input.value = parseInt(input.value) + 1;
    }
  };

  window.decreaseQuantity = function() {
    const input = document.getElementById('quantity-input');
    if (input && parseInt(input.value) > 1) {
      input.value = parseInt(input.value) - 1;
    }
  };

  // ============================
  // ADD TO CART
  // ============================
  window.addToCart = function(event) {
    event.preventDefault();

    const form = event.target.closest('form');
    const button = event.target.closest('button');
    const btnText = button.querySelector('.btn-text');
    const spinner = button.querySelector('.loading-spinner');

    button.classList.add('loading');
    if (btnText) btnText.classList.add('hidden');
    if (spinner) spinner.classList.remove('hidden');

    const formData = new FormData(form);

    fetch('/cart/add.js', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      console.log('Added to cart:', data);
      document.dispatchEvent(new CustomEvent('cart:updated'));

      setTimeout(() => {
        button.classList.remove('loading');
        if (btnText) btnText.classList.remove('hidden');
        if (spinner) spinner.classList.add('hidden');
      }, 1000);
    })
    .catch(error => {
      console.error('Error:', error);
      button.classList.remove('loading');
      if (btnText) btnText.classList.remove('hidden');
      if (spinner) spinner.classList.add('hidden');
    });
  };

  // ============================
  // ACCORDION
  // ============================
  window.toggleAccordion = function(button) {
    const item = button.closest('.accordion-item');
    const content = item.querySelector('.accordion-content');
    const isActive = item.classList.contains('active');

    // Close all accordions
    document.querySelectorAll('.accordion-item').forEach(acc => {
      acc.classList.remove('active');
      acc.querySelector('.accordion-content').style.maxHeight = null;
    });

    // Open clicked accordion if it wasn't active
    if (!isActive) {
      item.classList.add('active');
      content.style.maxHeight = content.scrollHeight + 'px';
    }
  };

  // ============================
  // CAROUSEL NAVIGATION
  // ============================
  window.scrollCarousel = function(direction, carouselType) {
    let carousel;

    if (carouselType === 'works-with') {
      carousel = document.querySelector('.works-with-carousel');
    } else if (carouselType === 'recommendations') {
      carousel = document.querySelector('.related-items-carousel');
    }

    if (!carousel) return;

    const scrollAmount = 240;

    if (direction === 'next') {
      carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
    } else {
      carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
    }
  };

  // ============================
  // VARIANT SELECTION
  // ============================
  const variantSelects = document.querySelectorAll('.variant-select');

  variantSelects.forEach(select => {
    select.addEventListener('change', function() {
      // Update hidden variant ID input
      // This would need proper variant matching logic
      console.log('Variant changed:', this.value);
    });
  });

  // ============================
  // UTILITY FUNCTIONS
  // ============================
  window.shareProduct = function() {
    if (navigator.share) {
      navigator.share({
        title: document.title,
        url: window.location.href
      }).catch(console.error);
    } else {
      // Fallback: copy to clipboard
      navigator.clipboard.writeText(window.location.href);
      alert('Link copied to clipboard!');
    }
  };

  window.addToWishlist = function(productId) {
    console.log('Add to wishlist:', productId);
    alert('Wishlist functionality coming soon!');
  };

});
</script>

{% schema %}
{
  "name": "Product - WebstaurantStore (Complete)",
  "settings": [
    {
      "type": "header",
      "content": "Demo Mode"
    },
    {
      "type": "checkbox",
      "id": "show_demo_data",
      "label": "Show Demo Data",
      "info": "Enable to preview all sections with example content even if product data is missing.",
      "default": false
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_free_shipping",
      "label": "Show Free Shipping Badge",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_protection_plan",
      "label": "Show Protection Plan Option",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_rewards",
      "label": "Show Rewards Info",
      "default": true
    }
  ]
}
{% endschema %}
