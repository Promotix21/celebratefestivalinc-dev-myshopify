<div style="max-width: 1400px; margin: 40px auto; padding: 20px; font-family: -apple-system, sans-serif;">
  
  <div style="text-align: center; margin-bottom: 40px;">
    <h1 style="font-size: 2.5em; color: #333;">Store Taxonomy Audit</h1>
    <p style="color: #666;">Product organization analysis</p>
  </div>

  {% comment %} Count total products {% endcomment %}
  {% assign total_products = 0 %}
  {% for product in collections.all.products %}
    {% assign total_products = total_products | plus: 1 %}
  {% endfor %}

  {% comment %} Collect unique types {% endcomment %}
  {% assign all_types = "" %}
  {% for product in collections.all.products %}
    {% if product.type != blank %}
      {% assign all_types = all_types | append: product.type | append: "|||" %}
    {% endif %}
  {% endfor %}
  {% assign unique_types = all_types | split: "|||" | uniq | sort %}

  {% comment %} Collect unique vendors {% endcomment %}
  {% assign all_vendors = "" %}
  {% for product in collections.all.products %}
    {% if product.vendor != blank %}
      {% assign all_vendors = all_vendors | append: product.vendor | append: "|||" %}
    {% endif %}
  {% endfor %}
  {% assign unique_vendors = all_vendors | split: "|||" | uniq | sort %}

  {% comment %} Collect unique tags {% endcomment %}
  {% assign all_tags = "" %}
  {% for product in collections.all.products %}
    {% for tag in product.tags %}
      {% assign all_tags = all_tags | append: tag | append: "|||" %}
    {% endfor %}
  {% endfor %}
  {% assign unique_tags = all_tags | split: "|||" | uniq | sort %}

  {% comment %} Collect unique categories {% endcomment %}
  {% assign all_categories = "" %}
  {% for product in collections.all.products %}
    {% if product.product_category != blank %}
      {% assign all_categories = all_categories | append: product.product_category | append: "|||" %}
    {% endif %}
  {% endfor %}
  {% assign unique_categories = all_categories | split: "|||" | uniq | sort %}

  {% comment %} DEBUG - Show first product's data {% endcomment %}
  {% assign first_product = collections.all.products.first %}

  <div style="background: #fff3cd; border-radius: 10px; padding: 20px; margin-bottom: 30px;">
    <h3 style="color: #856404; margin-top: 0;">Debug Info (First Product)</h3>
    <div style="background: white; padding: 10px; border-radius: 5px;">
      <strong>Product:</strong> {{ first_product.title }}<br>
      <strong>Type:</strong> {{ first_product.type | default: "EMPTY" }}<br>
      <strong>Vendor:</strong> {{ first_product.vendor | default: "EMPTY" }}<br>
      <strong>Tags:</strong> {{ first_product.tags | join: ", " | default: "EMPTY" }}<br>
      <strong>Category:</strong> {{ first_product.product_category | default: "EMPTY" }}<br>
      <strong>Total products found:</strong> {{ total_products }}
    </div>
  </div>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px;">
    <div style="background: #667eea; color: white; padding: 25px; border-radius: 10px; text-align: center;">
      <h3 style="margin: 0 0 10px 0; font-size: 0.9em; text-transform: uppercase;">Total Products</h3>
      <p style="font-size: 3em; font-weight: bold; margin: 0;">{{ total_products }}</p>
    </div>
    <div style="background: #667eea; color: white; padding: 25px; border-radius: 10px; text-align: center;">
      <h3 style="margin: 0 0 10px 0; font-size: 0.9em; text-transform: uppercase;">Categories</h3>
      <p style="font-size: 3em; font-weight: bold; margin: 0;">{{ unique_categories.size }}</p>
    </div>
    <div style="background: #667eea; color: white; padding: 25px; border-radius: 10px; text-align: center;">
      <h3 style="margin: 0 0 10px 0; font-size: 0.9em; text-transform: uppercase;">Product Types</h3>
      <p style="font-size: 3em; font-weight: bold; margin: 0;">{{ unique_types.size }}</p>
    </div>
    <div style="background: #667eea; color: white; padding: 25px; border-radius: 10px; text-align: center;">
      <h3 style="margin: 0 0 10px 0; font-size: 0.9em; text-transform: uppercase;">Vendors</h3>
      <p style="font-size: 3em; font-weight: bold; margin: 0;">{{ unique_vendors.size }}</p>
    </div>
    <div style="background: #667eea; color: white; padding: 25px; border-radius: 10px; text-align: center;">
      <h3 style="margin: 0 0 10px 0; font-size: 0.9em; text-transform: uppercase;">Tags</h3>
      <p style="font-size: 3em; font-weight: bold; margin: 0;">{{ unique_tags.size }}</p>
    </div>
  </div>

  {% if unique_categories.size > 0 %}
  <div style="background: white; border-radius: 10px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="color: #333; margin-top: 0; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #667eea;">Categories</h2>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">#</th>
          <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Category</th>
          <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Count</th>
        </tr>
      </thead>
      <tbody>
        {% for category in unique_categories %}
          {% if category != "" %}
            {% assign count = 0 %}
            {% for product in collections.all.products %}
              {% if product.product_category == category %}
                {% assign count = count | plus: 1 %}
              {% endif %}
            {% endfor %}
            <tr>
              <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ forloop.index }}</td>
              <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;"><strong>{{ category }}</strong></td>
              <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ count }}</td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <div style="background: white; border-radius: 10px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="color: #333; margin-top: 0; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #667eea;">Product Types</h2>
    {% if unique_types.size > 0 %}
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">#</th>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Type</th>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Count</th>
          </tr>
        </thead>
        <tbody>
          {% for type in unique_types %}
            {% if type != "" %}
              {% assign count = 0 %}
              {% for product in collections.all.products %}
                {% if product.type == type %}
                  {% assign count = count | plus: 1 %}
                {% endif %}
              {% endfor %}
              <tr>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ forloop.index }}</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;"><strong>{{ type }}</strong></td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ count }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p style="text-align: center; color: #999; padding: 20px;">No product types defined</p>
    {% endif %}
  </div>

  <div style="background: white; border-radius: 10px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="color: #333; margin-top: 0; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #667eea;">Vendors</h2>
    {% if unique_vendors.size > 0 %}
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">#</th>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Vendor</th>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Count</th>
          </tr>
        </thead>
        <tbody>
          {% for vendor in unique_vendors %}
            {% if vendor != "" %}
              {% assign count = 0 %}
              {% for product in collections.all.products %}
                {% if product.vendor == vendor %}
                  {% assign count = count | plus: 1 %}
                {% endif %}
              {% endfor %}
              <tr>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ forloop.index }}</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;"><strong>{{ vendor }}</strong></td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ count }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p style="text-align: center; color: #999; padding: 20px;">No vendors defined</p>
    {% endif %}
  </div>

  <div style="background: white; border-radius: 10px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="color: #333; margin-top: 0; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #667eea;">Tags</h2>
    {% if unique_tags.size > 0 %}
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">#</th>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Tag</th>
            <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Count</th>
          </tr>
        </thead>
        <tbody>
          {% for tag in unique_tags %}
            {% if tag != "" %}
              {% assign count = 0 %}
              {% for product in collections.all.products %}
                {% if product.tags contains tag %}
                  {% assign count = count | plus: 1 %}
                {% endif %}
              {% endfor %}
              <tr>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ forloop.index }}</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ tag }}</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ count }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p style="text-align: center; color: #999; padding: 20px;">No tags defined</p>
    {% endif %}
  </div>

  <div style="background: white; border-radius: 10px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h2 style="color: #333; margin-top: 0; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 3px solid #667eea;">Collections</h2>
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">#</th>
          <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Collection</th>
          <th style="background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6;">Count</th>
        </tr>
      </thead>
      <tbody>
        {% assign index = 0 %}
        {% for collection in collections %}
          {% unless collection.handle == 'all' or collection.handle == 'frontpage' %}
            {% assign index = index | plus: 1 %}
            <tr>
              <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ index }}</td>
              <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;"><strong>{{ collection.title }}</strong></td>
              <td style="padding: 12px 15px; border-bottom: 1px solid #e9ecef;">{{ collection.products_count }}</td>
            </tr>
          {% endunless %}
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

{% schema %}
{
  "name": "Store Audit",
  "settings": []
}
{% endschema %}
