{{ 'enhanced-header.css' | asset_url | stylesheet_tag }}

<style>
  .enhanced-header-wrapper .header-logo {
    max-width: {{ section.settings.logo_max_width | default: 180 }}px !important;
  }
  .enhanced-header-wrapper .marquee-text {
    font-size: {{ section.settings.marquee_text_size | default: 13 }}px !important;
  }
  .enhanced-header-wrapper .header-logo img {
    max-height: {{ section.settings.logo_height | default: 55 }}px !important;
  }
  .enhanced-header-wrapper .nav-icon {
    width: {{ section.settings.nav_icon_size | default: 20 }}px !important;
    height: {{ section.settings.nav_icon_size | default: 20 }}px !important;
  }
 
</style>

<div class="enhanced-header-wrapper">
  <!-- Top Bar -->
  {% if section.settings.enable_top_bar %}
    <div class="top-bar">
      <div class="marquee-container">
        <div class="marquee-text">
          {{ section.settings.marquee_text | default: 'ðŸš¨ MEGA SALE: Up to 40% OFF Commercial Equipment ðŸš¨ Free Installation on Orders $5000+ ðŸš¨ Free Nationwide Shipping on Select Items ðŸš¨ Price Match Guarantee ðŸš¨' }}
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Main Header -->
  <header class="main-header">
    <div class="header-container">
      <!-- Mobile Menu Button -->
      <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <!-- Logo -->
      <div class="header-logo">
        {% if section.settings.logo %}
          <a href="{{ routes.root_url }}">
            {{ section.settings.logo | image_url: width: 150 | image_tag: loading: 'eager', alt: shop.name }}
          </a>
        {% else %}
          <a href="{{ routes.root_url }}" style="font-size: 24px; font-weight: bold; text-decoration: none; color: inherit;">
            {{ shop.name }}
          </a>
        {% endif %}
      </div>

     <!-- Desktop Search Bar -->
<div class="header-search desktop-only">
  <form class="search-form" action="{{ routes.search_url }}" method="get" role="search">
    <input 
      type="search" 
      name="q" 
      class="search-input" 
      id="desktop-search-input"
      placeholder="{{ section.settings.search_placeholder | default: 'Search 10,000+ products...' }}" 
      value="{{ search.terms | escape }}" 
      autocomplete="off">
    <button type="submit" class="search-button" aria-label="Search">
      <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
        <path d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 7-7 7 7 0 0 1-7 7Z"/>
      </svg>
    </button>
    <div class="search-autocomplete" id="desktop-autocomplete"></div>
  </form>
</div>

      <!-- Desktop Header Actions -->
      <div class="header-actions desktop-only">
        <!-- Expert Help -->
<!-- Expert Help / Contact Us (Dynamic based on business hours) -->
{% if section.settings.show_expert_help %}
  <a href="tel:{{ section.settings.expert_help_phone }}" class="expert-help" id="expert-help-btn" style="text-decoration: none !important;">
    <div class="expert-help-icon" id="expert-help-icon">
      <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
        <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
      </svg>
    </div>
    <div class="expert-help-content">
      <span class="expert-help-label" id="expert-help-label">{{ section.settings.expert_help_label | default: 'EXPERT HELP' }}</span>
      <span class="expert-help-phone" id="expert-help-phone">
        {{ section.settings.expert_help_phone | default: '(408) 673-9999' }}
      </span>
    </div>
  </a>
{% endif %}

        <!-- Header Links -->
        <div class="header-links">
          <a href="{{ routes.account_url }}" class="header-link">
            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
            Login
          </a>
          <a href="{{ routes.cart_url }}" class="header-link cart-link">
            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
              <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
            {% if cart.item_count > 0 %}
              <span class="cart-count">{{ cart.item_count }}</span>
            {% endif %}
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Desktop Navigation -->
  <nav class="main-navigation desktop-only">
    <div class="nav-container">
      <!-- Navigation Links -->
      <ul class="nav-list">
        {% for link in linklists[section.settings.main_menu].links %}
          {% assign menu_type = 'regular' %}
          {% assign menu_icon = '' %}
          {% assign current_block = null %}

          {% for block in section.blocks %}
            {% if block.settings.menu_item_title == link.title %}
              {% assign menu_type = block.type %}
              {% assign menu_icon = block.settings.menu_icon %}
              {% assign current_block = block %}
              {% break %}
            {% endif %}
          {% endfor %}

          <li class="nav-item" data-menu-type="{{ menu_type }}" data-menu-handle="{{ link.handle }}">
            <a href="{{ link.url }}" class="nav-link">
              {% if menu_icon != blank %}
                <img src="{{ menu_icon | image_url: width: 22 }}" alt="" class="nav-icon">
              {% endif %}
              {{ link.title }}
              {% if link.links.size > 0 or menu_type != 'regular' %}
                <svg class="nav-dropdown-arrow" viewBox="0 0 24 24" fill="currentColor" width="12" height="12">
                  <path d="M7 10l5 5 5-5z"/>
                </svg>
              {% endif %}
            </a>
            
            <!-- Simple Dropdown -->
            {% if menu_type == 'simple_dropdown' and link.links.size > 0 %}
              <div class="simple-dropdown-menu" data-menu-handle="{{ link.handle }}">
                <ul>
                  {% for child_link in link.links %}
                    <li>
                      <a href="{{ child_link.url }}">{{ child_link.title }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      <!-- Mega Menu Containers -->
      <div class="mega-menu-containers">
        {% for link in linklists[section.settings.main_menu].links %}
          {% assign menu_type = 'regular' %}
          {% assign current_block = null %}

          {% for block in section.blocks %}
            {% if block.settings.menu_item_title == link.title %}
              {% assign menu_type = block.type %}
              {% assign current_block = block %}
              {% break %}
            {% endif %}
          {% endfor %}

          {% case menu_type %}
            {% when 'mega_menu_thumbnails' %}
              {% if link.links.size > 0 %}
                <div class="mega-menu mega-menu-{{ link.handle }}" data-menu-handle="{{ link.handle }}">
                  <div class="mega-menu-container">
                    <!-- 60/40 Split Layout -->
                    <div class="mega-menu-layout">

                      <!-- LEFT SIDE: 60% - Subcategory Items with Thumbnails -->
                      <div class="mega-menu-subcategories">
                        <div class="subcategory-grid">
                          {% assign total_items = link.links.size %}
                          {% assign items_per_column = total_items | plus: 1 | divided_by: 2 %}

                          <!-- Column 1 -->
                          <div class="subcategory-column">
                            {% for child_link in link.links limit: items_per_column %}
                              {% assign thumbnail_image = '' %}
                              {% for block in section.blocks %}
                                {% if block.type == 'menu_thumbnail' and block.settings.menu_item_title == child_link.title %}
                                  {% assign thumbnail_image = block.settings.thumbnail_image %}
                                  {% break %}
                                {% endif %}
                              {% endfor %}

                              <div class="subcategory-item" data-subcategory-id="{{ child_link.handle }}" data-has-children="{{ child_link.links.size | default: 0 }}">
                                <a href="{{ child_link.url }}" class="subcategory-link">
                                  <div class="subcategory-thumb">
                                    {% if thumbnail_image %}
                                      <img src="{{ thumbnail_image | image_url: width: 50 }}" alt="{{ child_link.title }}">
                                    {% else %}
                                      <div class="thumb-placeholder">
                                        <span>IMG</span>
                                      </div>
                                    {% endif %}
                                  </div>
                                  <span class="subcategory-title">{{ child_link.title }}</span>
                                </a>
                              </div>
                            {% endfor %}
                          </div>

                          <!-- Column 2 -->
                          <div class="subcategory-column">
                            {% for child_link in link.links offset: items_per_column %}
                              {% assign thumbnail_image = '' %}
                              {% for block in section.blocks %}
                                {% if block.type == 'menu_thumbnail' and block.settings.menu_item_title == child_link.title %}
                                  {% assign thumbnail_image = block.settings.thumbnail_image %}
                                  {% break %}
                                {% endif %}
                              {% endfor %}

                              <div class="subcategory-item" data-subcategory-id="{{ child_link.handle }}" data-has-children="{{ child_link.links.size | default: 0 }}">
                                <a href="{{ child_link.url }}" class="subcategory-link">
                                  <div class="subcategory-thumb">
                                    {% if thumbnail_image %}
                                      <img src="{{ thumbnail_image | image_url: width: 50 }}" alt="{{ child_link.title }}">
                                    {% else %}
                                      <div class="thumb-placeholder">
                                        <span>IMG</span>
                                      </div>
                                    {% endif %}
                                  </div>
                                  <span class="subcategory-title">{{ child_link.title }}</span>
                                </a>
                              </div>
                            {% endfor %}
                          </div>
                        </div>
                      </div>

                      <!-- RIGHT SIDE: 40% - Dynamic More Items Section -->
                      <div class="mega-menu-more" data-parent-handle="{{ link.handle }}">
                        <!-- Default "More Items" content -->
                        <div class="more-content-default more-content-active">
                          <h3 class="more-title">More in {{ link.title }}</h3>

                          {% if current_block.settings.more_items_menu != blank %}
                            {% assign more_menu = linklists[current_block.settings.more_items_menu] %}
                            {% if more_menu.links.size > 0 %}
                              {% assign max_items_per_column = 10 %}
                              {% assign max_total_items = 20 %}
                              {% assign total_more = more_menu.links.size %}
                              {% assign show_view_all = false %}
                              {% if total_more > max_total_items %}
                                {% assign show_view_all = true %}
                              {% endif %}

                              <div class="more-items-grid">
                                <!-- More Column 1 -->
                                <div class="more-column">
                                  {% for menu_link in more_menu.links limit: max_items_per_column %}
                                    <a href="{{ menu_link.url }}" class="more-link">
                                      {{ menu_link.title }}
                                    </a>
                                  {% endfor %}
                                </div>

                                <!-- More Column 2 -->
                                <div class="more-column">
                                  {% for menu_link in more_menu.links offset: max_items_per_column limit: max_items_per_column %}
                                    <a href="{{ menu_link.url }}" class="more-link">
                                      {{ menu_link.title }}
                                    </a>
                                  {% endfor %}
                                </div>
                              </div>

                              {% if show_view_all %}
                                <a href="{{ link.url }}" class="more-view-all">
                                  View All {{ link.title }} â†’
                                </a>
                              {% endif %}
                            {% endif %}
                          {% endif %}
                        </div>

                        <!-- Dynamic Level 3 content for each Level 2 item -->
                        {% for child_link in link.links %}
                          {% if child_link.links.size > 0 %}
                            <div class="more-content-dynamic" data-for-subcategory="{{ child_link.handle }}" style="display: none;">
                              <h3 class="more-title">{{ child_link.title }}</h3>

                              {% assign l3_total = child_link.links.size %}
                              {% assign l3_max_per_column = 10 %}
                              {% assign l3_show_view_all = false %}
                              {% if l3_total > 20 %}
                                {% assign l3_show_view_all = true %}
                              {% endif %}

                              <div class="more-items-grid">
                                <div class="more-column">
                                  {% for grandchild_link in child_link.links limit: l3_max_per_column %}
                                    <a href="{{ grandchild_link.url }}" class="more-link">
                                      {{ grandchild_link.title }}
                                    </a>
                                  {% endfor %}
                                </div>

                                <div class="more-column">
                                  {% for grandchild_link in child_link.links offset: l3_max_per_column limit: l3_max_per_column %}
                                    <a href="{{ grandchild_link.url }}" class="more-link">
                                      {{ grandchild_link.title }}
                                    </a>
                                  {% endfor %}
                                </div>
                              </div>

                              {% if l3_show_view_all %}
                                <a href="{{ child_link.url }}" class="more-view-all">
                                  View All {{ child_link.title }} â†’
                                </a>
                              {% endif %}
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>

                    </div>
                  </div>
                </div>
              {% endif %}

            {% when 'mega_menu' %}
              {% if link.links.size > 0 %}
                <div class="mega-menu mega-menu-{{ link.handle }}" data-menu-handle="{{ link.handle }}">
                  <div class="mega-menu-container">
                    <div class="mega-menu-grid">
                      <!-- Left: Menu Content -->
                      <div class="mega-menu-content">
                        {% for child_link in link.links %}
                          <div class="mega-menu-column">
                            <h3>{{ child_link.title }}</h3>
                            {% if child_link.links.size > 0 %}
                              <ul>
                                {% for grandchild_link in child_link.links %}
                                  <li>
                                    <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                                  </li>
                                {% endfor %}
                              </ul>
                            {% else %}
                              <a href="{{ child_link.url }}" class="view-all-link">View {{ child_link.title }} â†’</a>
                            {% endif %}
                          </div>
                        {% endfor %}
                      </div>

                      <!-- Right: Promotional Image -->
                      <div class="mega-menu-image" style="width: {{ current_block.settings.promo_image_width | default: 400 }}px; height: {{ current_block.settings.promo_image_height | default: 250 }}px; display: flex; align-items: {{ current_block.settings.image_position | default: 'center' }}; justify-content: center; {% if current_block.settings.image_rounded_corners %}border-radius: 12px; overflow: hidden;{% endif %} {% if current_block.settings.image_shadow %}box-shadow: 0 4px 12px rgba(0,0,0,0.1);{% endif %}">
                        {% if current_block.settings.promo_image %}
                          <img src="{{ current_block.settings.promo_image | image_url: width: current_block.settings.promo_image_width | default: 400 }}" alt="{{ current_block.settings.promo_title | default: 'Featured Equipment' }}" style="width: 100%; height: 100%; object-fit: {{ current_block.settings.image_fit | default: 'cover' }}; {% if current_block.settings.image_rounded_corners %}border-radius: 8px;{% endif %}">
                        {% else %}
                          <div class="placeholder-image" style="width: 100%; height: 100%; background: #f0f0f0; border: 2px dashed #ccc; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #999; font-size: 14px; text-align: center;">
                            <div>
                              <div>Add promo image</div>
                              <div style="font-size: 12px; margin-top: 5px;">
                                {{ current_block.settings.promo_image_width | default: 400 }}px Ã— {{ current_block.settings.promo_image_height | default: 250 }}px
                              </div>
                            </div>
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endif %}

           {% when 'logo_grid' %}
  <div class="mega-menu mega-menu-{{ link.handle }}" data-menu-handle="{{ link.handle }}">
    <div class="mega-menu-container">
      {% assign logo_items = section.blocks | where: 'type', 'logo_grid_item' %}

      {% if logo_items.size > 0 %}
        <div class="logo-grid" style="grid-template-columns: repeat({{ current_block.settings.logos_per_row | default: 8 }}, 1fr);">
          {% for logo_item in logo_items %}
            {% if logo_item.settings.parent_menu_title == link.title %}
              <div class="logo-grid-item">
                {% if logo_item.settings.brand_url != blank -%}
                  <a href="{{ logo_item.settings.brand_url }}">
                {%- endif %}
                {% if logo_item.settings.brand_logo %}
                  <img src="{{ logo_item.settings.brand_logo | image_url: width: 120 }}" alt="{{ logo_item.settings.brand_name }}">
                {% else %}
                  <span class="brand-name-text">{{ logo_item.settings.brand_name }}</span>
                {% endif %}
                {% if logo_item.settings.brand_url != blank %}</a>{% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
        {% if current_block.settings.show_view_all and current_block.settings.view_all_url != blank %}
          <div class="logo-grid-footer">
            <a href="{{ current_block.settings.view_all_url }}" class="view-all-brands-btn">{{ current_block.settings.view_all_text | default: 'View All Brands' }}</a>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>
          {% endcase %}
        {% endfor %}
      </div>
    </div>
  </nav>

  <!-- Mobile Menu (keeping existing structure) -->
  <div class="mobile-menu-overlay" id="mobile-menu-overlay">
    <div class="mobile-menu">
      <div class="mobile-menu-header">
        <div class="mobile-menu-top">
          <div class="mobile-menu-logo">
            {% if section.settings.logo %}
              <img src="{{ section.settings.logo | image_url: width: 200 }}" alt="{{ shop.name }}" style="height: {{ section.settings.mobile_menu_logo_height | default: 50 }}px; width: auto;">
            {% else %}
              <span style="font-size: {{ section.settings.mobile_menu_logo_height | default: 50 | divided_by: 2 }}px; font-weight: bold;">{{ shop.name }}</span>
            {% endif %}
          </div>
          <button class="mobile-menu-close" id="mobile-menu-close">
            <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        
      <div class="mobile-search">
  <form class="search-form" action="{{ routes.search_url }}" method="get" role="search">
    <input 
      type="search" 
      name="q" 
      class="search-input" 
      id="mobile-search-input"
      placeholder="Search products..." 
      value="{{ search.terms | escape }}"
      autocomplete="off">
    <button type="submit" class="search-button">
      <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
        <path d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 7-7 7 7 0 0 1-7 7Z"/>
      </svg>
    </button>
    <div class="search-autocomplete" id="mobile-autocomplete"></div>
  </form>
</div>

        <div class="mobile-header-actions">
          <div class="mobile-expert-section">
            {% if section.settings.show_expert_help %}
            <a href="tel:{{ section.settings.expert_help_phone }}" class="mobile-expert">
              <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
              </svg>
              {{ section.settings.expert_help_phone | default: "(408) 673-9999" }}
            </a>
            {% endif %}
          </div>
          
          <div class="mobile-actions-right">
            <a href="{{ routes.account_url }}" class="mobile-icon-action">
              <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </a>
            <a href="{{ routes.cart_url }}" class="mobile-icon-action cart-action">
              <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
              </svg>
              {% if cart.item_count > 0 %}
                <span class="cart-count-badge">{{ cart.item_count }}</span>
              {% endif %}
            </a>
          </div>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <div class="mobile-nav">
        {% for link in linklists[section.settings.main_menu].links %}
          {% assign menu_type = 'regular' %}
          {% assign menu_icon = '' %}

          {% for block in section.blocks %}
            {% if block.settings.menu_item_title == link.title %}
              {% assign menu_type = block.type %}
              {% assign menu_icon = block.settings.menu_icon %}
              {% break %}
            {% endif %}
          {% endfor %}

          <div class="mobile-nav-item">
            {% if link.links.size > 0 %}
              <button class="mobile-nav-toggle" data-target="mobile-submenu-{{ link.handle }}">
                {% if menu_icon != blank %}
                  <img src="{{ menu_icon | image_url: width: 20 }}" alt="" class="mobile-nav-icon">
                {% endif %}
                {{ link.title }}
                <svg class="mobile-nav-arrow" viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                  <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
                </svg>
              </button>

              <div class="mobile-submenu" id="mobile-submenu-{{ link.handle }}">
                {% for child_link in link.links %}
                  {% if child_link.links.size > 0 %}
                    <div class="mobile-submenu-section">
                      <h4>{{ child_link.title }}</h4>
                      {% for grandchild_link in child_link.links %}
                        <a href="{{ grandchild_link.url }}">{{ grandchild_link.title }}</a>
                      {% endfor %}
                    </div>
                  {% else %}
                    <a href="{{ child_link.url }}" class="mobile-submenu-link">{{ child_link.title }}</a>
                  {% endif %}
                {% endfor %}
              </div>
            {% else %}
              <a href="{{ link.url }}" class="mobile-nav-link">
                {% if menu_icon != blank %}
                  <img src="{{ menu_icon | image_url: width: 20 }}" alt="" class="mobile-nav-icon">
                {% endif %}
                {{ link.title }}
              </a>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- JavaScript (keeping existing functionality) -->
<!-- JavaScript -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // ============================================
    // BUSINESS HOURS CHECKER
    // ============================================
    function checkBusinessHours() {
      const expertHelpBtn = document.getElementById('expert-help-btn');
      const expertHelpLabel = document.getElementById('expert-help-label');
      const expertHelpPhone = document.getElementById('expert-help-phone');
      const expertHelpIcon = document.getElementById('expert-help-icon');
      
      if (!expertHelpBtn) return;

      // Get current time in PST/PDT
      const now = new Date();
      const pstTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/Los_Angeles' }));
      
      const day = pstTime.getDay(); // 0 = Sunday, 6 = Saturday
      const hour = pstTime.getHours();
      
      // Business hours: Monday-Friday, 9 AM - 6 PM PST
      const isBusinessHours = (day >= 1 && day <= 5) && (hour >= 9 && hour < 18);
      
      if (isBusinessHours) {
        // Online - Show Expert Help with phone
        expertHelpBtn.href = 'tel:{{ section.settings.expert_help_phone }}';
        expertHelpBtn.classList.remove('offline');
        expertHelpLabel.textContent = '{{ section.settings.expert_help_label | default: "EXPERT HELP" }}';
        expertHelpPhone.textContent = '{{ section.settings.expert_help_phone | default: "(408) 673-9999" }}';
        expertHelpIcon.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>';
      } else {
        // Offline - Show Contact Us
        expertHelpBtn.href = '/pages/contact-us';
        expertHelpBtn.classList.add('offline');
        expertHelpLabel.textContent = 'WE\'RE OFFLINE';
        expertHelpPhone.textContent = 'Contact Us';
        expertHelpIcon.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>';
      }
    }
    
    // Check immediately and every minute
    checkBusinessHours();
    setInterval(checkBusinessHours, 60000);

    // ============================================
    // PREDICTIVE SEARCH
    // ============================================
    let searchTimeout;
    
   function initPredictiveSearch(inputId, autocompleteId) {
  const searchInput = document.getElementById(inputId);
  const autocompleteContainer = document.getElementById(autocompleteId);
  
  if (!searchInput || !autocompleteContainer) return;
  
  searchInput.addEventListener('input', function() {
    clearTimeout(searchTimeout);
    const query = this.value.trim();
    
    if (query.length < 2) {
      autocompleteContainer.classList.remove('active');
      autocompleteContainer.innerHTML = '';
      return;
    }
    
    autocompleteContainer.innerHTML = '<div class="autocomplete-loading">Searching...</div>';
    autocompleteContainer.classList.add('active');
    
    searchTimeout = setTimeout(() => {
      fetch(`/search/suggest.json?q=${encodeURIComponent(query)}&resources[type]=product&resources[limit]=5`)
        .then(response => response.json())
        .then(data => {
          const products = data.resources.results.products || [];
          
          if (products.length === 0) {
            autocompleteContainer.innerHTML = '<div class="autocomplete-no-results">No products found</div>';
            return;
          }
          
          let html = '';
          const maxProducts = Math.min(products.length, 5);
          
         for (let i = 0; i < maxProducts; i++) {
  const product = products[i];
  let imageUrl = '';
  
  // Fix image URL - Shopify returns image object
  if (product.image) {
    imageUrl = product.image;
  } else if (product.featured_image) {
    imageUrl = product.featured_image;
  }
  
  html += `
    <a href="${product.url}" class="autocomplete-item">
      ${imageUrl ? `<img src="${imageUrl}" alt="${product.title}" class="autocomplete-image" loading="lazy">` : '<div class="autocomplete-image"></div>'}
      <div class="autocomplete-details">
        <div class="autocomplete-title">${product.title}</div>
      </div>
    </a>
  `;
}
          
          html += `
            <a href="/search?q=${encodeURIComponent(query)}" class="autocomplete-view-all">
              View All Results â†’
            </a>
          `;
          
          autocompleteContainer.innerHTML = html;
        })
        .catch(error => {
          console.error('Search error:', error);
          autocompleteContainer.innerHTML = '<div class="autocomplete-no-results">Error loading results</div>';
        });
    }, 300);
  });
  
  // Close autocomplete when clicking outside
  document.addEventListener('click', function(e) {
    if (!searchInput.contains(e.target) && !autocompleteContainer.contains(e.target)) {
      autocompleteContainer.classList.remove('active');
    }
  });
  
  // Close on ESC key
  searchInput.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      autocompleteContainer.classList.remove('active');
    }
  });
}
    
    // Initialize for both desktop and mobile search
    initPredictiveSearch('desktop-search-input', 'desktop-autocomplete');
    initPredictiveSearch('mobile-search-input', 'mobile-autocomplete');

    // ============================================
    // EXISTING MOBILE MENU CODE
    // ============================================
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
    const body = document.body;

    mobileMenuToggle.addEventListener('click', function () {
      mobileMenuOverlay.classList.toggle('active');
      body.classList.toggle('mobile-menu-open');
      this.classList.toggle('active');
    });

    mobileMenuOverlay.addEventListener('click', function (e) {
      if (e.target === this) {
        mobileMenuOverlay.classList.remove('active');
        body.classList.remove('mobile-menu-open');
        mobileMenuToggle.classList.remove('active');
      }
    });

    const mobileMenuClose = document.getElementById('mobile-menu-close');
    if (mobileMenuClose) {
      mobileMenuClose.addEventListener('click', function() {
        mobileMenuOverlay.classList.remove('active');
        body.classList.remove('mobile-menu-open');
        mobileMenuToggle.classList.remove('active');
      });
    }

    const mobileNavToggles = document.querySelectorAll('.mobile-nav-toggle');
    mobileNavToggles.forEach((toggle) => {
      toggle.addEventListener('click', function () {
        const targetId = this.getAttribute('data-target');
        const submenu = document.getElementById(targetId);
        const arrow = this.querySelector('.mobile-nav-arrow');

        document.querySelectorAll('.mobile-submenu').forEach((menu) => {
          if (menu !== submenu) {
            menu.classList.remove('active');
          }
        });

        document.querySelectorAll('.mobile-nav-arrow').forEach((arr) => {
          if (arr !== arrow) {
            arr.style.transform = 'rotate(0deg)';
          }
        });

        submenu.classList.toggle('active');
        arrow.style.transform = submenu.classList.contains('active') ? 'rotate(90deg)' : 'rotate(0deg)';
      });
    });

    window.addEventListener('scroll', function() {
      const header = document.querySelector('.enhanced-header-wrapper');
      if (window.scrollY > 100) {
        header.classList.add('scrolled');
      } else {
        header.classList.remove('scrolled');
      }
    });

    // ============================================
    // EXISTING DESKTOP NAVIGATION CODE
    // ============================================
    const navItems = document.querySelectorAll('.nav-item');
    const megaMenus = document.querySelectorAll('.mega-menu');
    const simpleDropdowns = document.querySelectorAll('.simple-dropdown-menu');

    megaMenus.forEach((menu) => {
      menu.style.opacity = '0';
      menu.style.visibility = 'hidden';
    });

    simpleDropdowns.forEach((dropdown) => {
      dropdown.style.opacity = '0';
      dropdown.style.visibility = 'hidden';
    });

    // Helper function to show mega menu
    function showMegaMenu(menu) {
      menu.style.opacity = '1';
      menu.style.visibility = 'visible';
      menu.style.pointerEvents = 'auto';
      menu.classList.add('is-visible');
    }

    // Helper function to hide mega menu
    function hideMegaMenu(menu) {
      menu.style.opacity = '0';
      menu.style.visibility = 'hidden';
      menu.style.pointerEvents = 'none';
      menu.classList.remove('is-visible');
    }

    // Helper function to hide all menus
    function hideAllMenus() {
      megaMenus.forEach((menu) => hideMegaMenu(menu));
      simpleDropdowns.forEach((dropdown) => {
        dropdown.style.opacity = '0';
        dropdown.style.visibility = 'hidden';
      });
    }

    navItems.forEach((navItem) => {
      const menuHandle = navItem.dataset.menuHandle;
      const menuType = navItem.dataset.menuType;
      const correspondingMegaMenu = document.querySelector(`.mega-menu-${menuHandle}`);
      const correspondingSimpleDropdown = navItem.querySelector('.simple-dropdown-menu');

      if (correspondingMegaMenu && (menuType === 'mega_menu' || menuType === 'mega_menu_thumbnails')) {
        navItem.addEventListener('mouseenter', () => {
          hideAllMenus();
          showMegaMenu(correspondingMegaMenu);
        });

        correspondingMegaMenu.addEventListener('mouseenter', () => {
          showMegaMenu(correspondingMegaMenu);
        });

        navItem.addEventListener('mouseleave', () => {
          setTimeout(() => {
            if (!correspondingMegaMenu.matches(':hover') && !navItem.matches(':hover')) {
              hideMegaMenu(correspondingMegaMenu);
            }
          }, 150);
        });

        correspondingMegaMenu.addEventListener('mouseleave', () => {
          setTimeout(() => {
            if (!correspondingMegaMenu.matches(':hover') && !navItem.matches(':hover')) {
              hideMegaMenu(correspondingMegaMenu);
            }
          }, 150);
        });
      }

      if (correspondingSimpleDropdown && menuType === 'simple_dropdown') {
        navItem.addEventListener('mouseenter', () => {
          megaMenus.forEach((menu) => {
            menu.style.opacity = '0';
            menu.style.visibility = 'hidden';
          });
          simpleDropdowns.forEach((dropdown) => {
            dropdown.style.opacity = '0';
            dropdown.style.visibility = 'hidden';
          });

          correspondingSimpleDropdown.style.opacity = '1';
          correspondingSimpleDropdown.style.visibility = 'visible';
        });

        correspondingSimpleDropdown.addEventListener('mouseenter', () => {
          correspondingSimpleDropdown.style.opacity = '1';
          correspondingSimpleDropdown.style.visibility = 'visible';
        });

        navItem.addEventListener('mouseleave', () => {
          setTimeout(() => {
            if (!correspondingSimpleDropdown.matches(':hover') && !navItem.matches(':hover')) {
              correspondingSimpleDropdown.style.opacity = '0';
              correspondingSimpleDropdown.style.visibility = 'hidden';
            }
          }, 100);
        });

        correspondingSimpleDropdown.addEventListener('mouseleave', () => {
          setTimeout(() => {
            if (!correspondingSimpleDropdown.matches(':hover') && !navItem.matches(':hover')) {
              correspondingSimpleDropdown.style.opacity = '0';
              correspondingSimpleDropdown.style.visibility = 'hidden';
            }
          }, 100);
        });
      }

      if (correspondingMegaMenu && menuType === 'logo_grid') {
        navItem.addEventListener('mouseenter', () => {
          hideAllMenus();
          showMegaMenu(correspondingMegaMenu);
        });

        correspondingMegaMenu.addEventListener('mouseenter', () => {
          showMegaMenu(correspondingMegaMenu);
        });

        navItem.addEventListener('mouseleave', () => {
          setTimeout(() => {
            if (!correspondingMegaMenu.matches(':hover') && !navItem.matches(':hover')) {
              hideMegaMenu(correspondingMegaMenu);
            }
          }, 150);
        });

        correspondingMegaMenu.addEventListener('mouseleave', () => {
          setTimeout(() => {
            if (!correspondingMegaMenu.matches(':hover') && !navItem.matches(':hover')) {
              hideMegaMenu(correspondingMegaMenu);
            }
          }, 150);
        });
      }
    });

    // ============================================
    // DYNAMIC LEVEL 3 HOVER INTERACTION
    // ============================================
    const subcategoryItems = document.querySelectorAll('.subcategory-item');

    subcategoryItems.forEach((item) => {
      const subcategoryId = item.dataset.subcategoryId;
      const hasChildren = parseInt(item.dataset.hasChildren) > 0;
      const megaMenu = item.closest('.mega-menu');
      const moreSection = megaMenu ? megaMenu.querySelector('.mega-menu-more') : null;

      if (moreSection && hasChildren) {
        const defaultContent = moreSection.querySelector('.more-content-default');
        const dynamicContent = moreSection.querySelector(`[data-for-subcategory="${subcategoryId}"]`);

        if (dynamicContent) {
          item.addEventListener('mouseenter', () => {
            // Hide default content
            if (defaultContent) {
              defaultContent.style.display = 'none';
              defaultContent.classList.remove('more-content-active');
            }
            // Hide all dynamic content
            moreSection.querySelectorAll('.more-content-dynamic').forEach((content) => {
              content.style.display = 'none';
            });
            // Show this subcategory's content
            dynamicContent.style.display = 'block';
          });

          item.addEventListener('mouseleave', () => {
            // Don't immediately hide - let mouse move to more section
            setTimeout(() => {
              const isHoveringMore = moreSection.matches(':hover');
              const isHoveringItem = item.matches(':hover');
              if (!isHoveringMore && !isHoveringItem) {
                // Reset to default
                dynamicContent.style.display = 'none';
                if (defaultContent) {
                  defaultContent.style.display = 'block';
                  defaultContent.classList.add('more-content-active');
                }
              }
            }, 150);
          });
        }
      }
    });

    // Reset to default when mouse leaves the more section
    document.querySelectorAll('.mega-menu-more').forEach((moreSection) => {
      moreSection.addEventListener('mouseleave', () => {
        const defaultContent = moreSection.querySelector('.more-content-default');
        moreSection.querySelectorAll('.more-content-dynamic').forEach((content) => {
          content.style.display = 'none';
        });
        if (defaultContent) {
          defaultContent.style.display = 'block';
          defaultContent.classList.add('more-content-active');
        }
      });
    });
  });
</script>

{% schema %}
{
  "name": "Enhanced Header",
  "class": "enhanced-header-section",
  "settings": [
    {
      "type": "header",
      "content": "Top Bar"
    },
    {
      "type": "checkbox",
      "id": "enable_top_bar",
      "label": "Enable top bar",
      "default": true
    },
    {
      "type": "text",
      "id": "marquee_text",
      "label": "Marquee text",
      "default": "ðŸš¨ MEGA SALE: Up to 40% OFF Commercial Equipment ðŸš¨ Free Installation on Orders $5000+ ðŸš¨ Free Nationwide Shipping on Select Items ðŸš¨ Price Match Guarantee ðŸš¨"
    },
    {
      "type": "range",
      "id": "marquee_text_size",
      "label": "Marquee text size",
      "min": 10,
      "max": 18,
      "step": 1,
      "unit": "px",
      "default": 13
    },
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo image"
    },
    {
      "type": "range",
      "id": "logo_height",
      "label": "Logo height",
      "min": 30,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 55
    },
    {
      "type": "range",
      "id": "logo_max_width",
      "label": "Logo max width",
      "min": 100,
      "max": 300,
      "step": 10,
      "unit": "px",
      "default": 180
    },
    {
      "type": "range",
      "id": "mobile_menu_logo_height",
      "label": "Mobile menu logo height",
      "min": 30,
      "max": 80,
      "step": 5,
      "unit": "px",
      "default": 50
    },
    {
      "type": "header",
      "content": "Search"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search placeholder text",
      "default": "Search 10,000+ products..."
    },
    {
      "type": "header",
      "content": "Expert Help"
    },
    {
      "type": "checkbox",
      "id": "show_expert_help",
      "label": "Show expert help",
      "default": true
    },
    {
      "type": "text",
      "id": "expert_help_label",
      "label": "Expert help label",
      "default": "EXPERT HELP"
    },
    {
      "type": "text",
      "id": "expert_help_phone",
      "label": "Expert help phone",
      "default": "(408) 673-9999"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main navigation menu",
      "default": "main-menu"
    },
    {
      "type": "range",
      "id": "nav_icon_size",
      "label": "Menu icon size",
      "min": 16,
      "max": 32,
      "step": 2,
      "unit": "px",
      "default": 20
    }
  ],
  "blocks": [
    {
      "type": "mega_menu_thumbnails",
      "name": "Mega Menu with Thumbnails",
      "settings": [
        {
          "type": "text",
          "id": "menu_item_title",
          "label": "Menu item title",
          "info": "Enter the exact title of the menu item from your navigation (case-sensitive)"
        },
        {
          "type": "image_picker",
          "id": "menu_icon",
          "label": "Menu icon"
        },
        {
          "type": "header",
          "content": "More Items Section"
        },
        {
          "type": "link_list",
          "id": "more_items_menu",
          "label": "Menu for 'More in [Category]' items",
          "info": "Select a Shopify menu to populate the right sidebar with category links"
        },
        {
          "type": "header",
          "content": "Instructions"
        },
        {
          "type": "paragraph",
          "content": "1. Enter the exact menu item title above\n2. Select a menu for the 'More in [Category]' section\n3. Add 'Menu Thumbnail' blocks below for each submenu item with images"
        }
      ]
    },
    {
      "type": "menu_thumbnail",
      "name": "Menu Thumbnail",
      "settings": [
        {
          "type": "text",
          "id": "menu_item_title",
          "label": "Submenu item title",
          "info": "Enter the exact title of the submenu item (case-sensitive)"
        },
        {
          "type": "image_picker",
          "id": "thumbnail_image",
          "label": "Thumbnail image",
          "info": "Recommended size: 80x80px"
        }
      ]
    },
    {
      "type": "mega_menu",
      "name": "Mega Menu (Classic)",
      "settings": [
        {
          "type": "text",
          "id": "menu_item_title",
          "label": "Menu item title",
          "info": "Enter the exact title of the menu item from your navigation (case-sensitive)"
        },
        {
          "type": "image_picker",
          "id": "menu_icon",
          "label": "Menu icon"
        },
        {
          "type": "range",
          "id": "columns",
          "label": "Number of menu columns",
          "min": 2,
          "max": 4,
          "step": 1,
          "default": 3,
          "info": "Number of columns for menu content (image is always 1 column on right)"
        },
        {
          "type": "header",
          "content": "Promotional Content (Right Side)"
        },
        {
          "type": "image_picker",
          "id": "promo_image",
          "label": "Promotional image"
        },
        {
          "type": "range",
          "id": "promo_image_width",
          "label": "Image width",
          "min": 200,
          "max": 600,
          "step": 50,
          "unit": "px",
          "default": 400
        },
        {
          "type": "range",
          "id": "promo_image_height",
          "label": "Image height",
          "min": 150,
          "max": 500,
          "step": 25,
          "unit": "px",
          "default": 250
        },
        {
          "type": "select",
          "id": "image_fit",
          "label": "Image fit",
          "options": [
            { "value": "cover", "label": "Cover (fill entire area)" },
            { "value": "contain", "label": "Contain (fit within area)" },
            { "value": "fill", "label": "Fill (stretch to fit)" }
          ],
          "default": "cover"
        },
        {
          "type": "text",
          "id": "promo_title",
          "label": "Promotional title",
          "default": "Featured Equipment"
        },
        {
          "type": "textarea",
          "id": "promo_text",
          "label": "Promotional text",
          "default": "Discover our latest commercial equipment"
        },
        {
          "type": "url",
          "id": "promo_url",
          "label": "Promotional link URL"
        },
        {
          "type": "text",
          "id": "promo_button_text",
          "label": "Button text",
          "default": "Shop Now"
        },
        {
          "type": "header",
          "content": "Image Styling Options"
        },
        {
          "type": "checkbox",
          "id": "image_rounded_corners",
          "label": "Rounded corners",
          "default": true
        },
        {
          "type": "checkbox",
          "id": "image_shadow",
          "label": "Add shadow",
          "default": true
        },
        {
          "type": "select",
          "id": "image_position",
          "label": "Image position in container",
          "options": [
            { "value": "center", "label": "Center" },
            { "value": "top", "label": "Top" },
            { "value": "bottom", "label": "Bottom" }
          ],
          "default": "center"
        }
      ]
    },
    {
      "type": "logo_grid",
      "name": "Logo Grid Menu",
      "settings": [
        {
          "type": "text",
          "id": "menu_item_title",
          "label": "Menu item title",
          "info": "Enter the exact title of the menu item from your navigation (case-sensitive)"
        },
        {
          "type": "image_picker",
          "id": "menu_icon",
          "label": "Menu icon"
        },
        {
          "type": "range",
          "id": "logos_per_row",
          "label": "Logos per row",
          "min": 4,
          "max": 12,
          "step": 1,
          "default": 8
        },
        {
          "type": "checkbox",
          "id": "show_view_all",
          "label": "Show 'View All' button",
          "default": false
        },
        {
          "type": "url",
          "id": "view_all_url",
          "label": "'View All' button URL"
        },
        {
          "type": "text",
          "id": "view_all_text",
          "label": "'View All' button text",
          "default": "View All Brands"
        }
      ]
    },
    {
      "type": "logo_grid_item",
      "name": "Brand Logo",
      "settings": [
        {
          "type": "text",
          "id": "parent_menu_title",
          "label": "Parent menu item title",
          "info": "Enter the exact title of the parent menu item (case-sensitive)"
        },
        {
          "type": "text",
          "id": "brand_name",
          "label": "Brand name",
          "info": "Name displayed under the logo"
        },
        {
          "type": "image_picker",
          "id": "brand_logo",
          "label": "Brand logo image"
        },
        {
          "type": "url",
          "id": "brand_url",
          "label": "Brand page URL"
        }
      ]
    },
    {
      "type": "simple_dropdown",
      "name": "Simple Dropdown Menu",
      "settings": [
        {
          "type": "text",
          "id": "menu_item_title",
          "label": "Menu item title",
          "info": "Enter the exact title of the menu item from your navigation (case-sensitive)"
        },
        {
          "type": "image_picker",
          "id": "menu_icon",
          "label": "Menu icon"
        }
      ]
    },
    {
      "type": "regular",
      "name": "Regular Menu Item",
      "settings": [
        {
          "type": "text",
          "id": "menu_item_title",
          "label": "Menu item title",
          "info": "Enter the exact title of the menu item from your navigation (case-sensitive)"
        },
        {
          "type": "image_picker",
          "id": "menu_icon",
          "label": "Menu icon"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Enhanced Header with Thumbnails",
      "blocks": [
        {
          "type": "mega_menu_thumbnails",
          "settings": {
            "menu_item_title": "Restaurant Equipment"
          }
        },
        {
          "type": "mega_menu",
          "settings": {
            "menu_item_title": "Cookware"
          }
        },
        {
          "type": "logo_grid",
          "settings": {
            "menu_item_title": "Shop by Brands"
          }
        },
        {
          "type": "simple_dropdown",
          "settings": {
            "menu_item_title": "Dinnerware Tabletop"
          }
        }
      ]
    }
  ]
}
{% endschema %}
